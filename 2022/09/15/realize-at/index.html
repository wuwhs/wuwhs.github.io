<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.png?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="èƒŒæ™¯ä¸€å¤©äº§å“å¤§å¤§å‘ boss æ±‡æŠ¥å®Œç ”å‘æˆæœå’Œäº§å“ä¸šç»©äº§å‡ºï¼Œè‹¥æœ‰æ‰€æ€çš„èµ°å‡ºæ¥ï¼ŒåŠ²ç›´å‘æˆ‘èµ°è¿‡æ¥ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬ã€‚äº§å“å¤§å¤§ï¼šboss å¯¹æˆ‘ä»¬çš„ç ”å‘æˆæœæŒºæ»¡æ„çš„ï¼Œbalabalaâ€¦ï¼ˆå†…å¿ƒ OSï¼šä¸å¬ï¼Œè®²é‡ç‚¹ï¼‰äº§å“å¤§å¤§ï¼šå’±ä»¬çš„å®¢æœ IM æ¡Œé¢å®¢æˆ·ç«¯ç°åœ¨å·²ç»æœ‰èƒ½åŠ›åšåˆ° 1 å¯¹å¤šæ¥å¾…åœ¨çº¿è®¿å®¢äº†ï¼Œåé¢æˆ‘ä»¬æƒ³è¦å°†ä¸“é¡¹é—®é¢˜è®¿å®¢åœ¨å½“å‰æ¥å¾…å®¢æœä¸èƒ½è§£å†³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‹‰ä¸“é¡¹å®¢æœå‘èµ·ç¾¤èŠã€‚æˆ‘ï¼šå—¯ï¼Œè¿™ä¸ªæƒ³æ³•ä¸é”™ï¼Œä¸“é¡¹å®¢æœè¿˜èƒ½ä¸€">
<meta name="keywords" content="javascript html5">
<meta property="og:type" content="article">
<meta property="og:title" content="realize-at">
<meta property="og:url" content="https://wuwhs.gitee.io/2022/09/15/realize-at/index.html">
<meta property="og:site_name" content="wuwh&#39;s blog">
<meta property="og:description" content="èƒŒæ™¯ä¸€å¤©äº§å“å¤§å¤§å‘ boss æ±‡æŠ¥å®Œç ”å‘æˆæœå’Œäº§å“ä¸šç»©äº§å‡ºï¼Œè‹¥æœ‰æ‰€æ€çš„èµ°å‡ºæ¥ï¼ŒåŠ²ç›´å‘æˆ‘èµ°è¿‡æ¥ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬ã€‚äº§å“å¤§å¤§ï¼šboss å¯¹æˆ‘ä»¬çš„ç ”å‘æˆæœæŒºæ»¡æ„çš„ï¼Œbalabalaâ€¦ï¼ˆå†…å¿ƒ OSï¼šä¸å¬ï¼Œè®²é‡ç‚¹ï¼‰äº§å“å¤§å¤§ï¼šå’±ä»¬çš„å®¢æœ IM æ¡Œé¢å®¢æˆ·ç«¯ç°åœ¨å·²ç»æœ‰èƒ½åŠ›åšåˆ° 1 å¯¹å¤šæ¥å¾…åœ¨çº¿è®¿å®¢äº†ï¼Œåé¢æˆ‘ä»¬æƒ³è¦å°†ä¸“é¡¹é—®é¢˜è®¿å®¢åœ¨å½“å‰æ¥å¾…å®¢æœä¸èƒ½è§£å†³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‹‰ä¸“é¡¹å®¢æœå‘èµ·ç¾¤èŠã€‚æˆ‘ï¼šå—¯ï¼Œè¿™ä¸ªæƒ³æ³•ä¸é”™ï¼Œä¸“é¡¹å®¢æœè¿˜èƒ½ä¸€">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389649885-df19671d-6b75-4375-8ea1-310481544199.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389674758-aec15344-10ed-40a0-be3c-34cd2cde513b.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389710497-a13651e7-3f6e-40d5-82dd-f2f4b9ad5901.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389727309-4831ce20-3bea-4b0c-9bec-86219a9c6427.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389742937-1b7b8b0c-2e1d-482a-8e45-f86b3c01620a.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1663148689420-1c042136-3b5a-4f15-ab7f-0c706a62568e.jpeg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662215604275-69e9f544-0b5a-4ba1-acf7-2d6a49928d03.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662216141776-85c105ca-898d-4821-b132-cd703eaab3df.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662435977354-b19ed561-61ec-4d8f-a184-9ae73f1f9b07.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662436107528-1001e4af-e644-4571-8d26-ee085792e019.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662436465512-d56fa927-a301-4e5a-b039-5e32c4443b07.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662390599870-23189fbe-5149-43dc-8492-5d06e425464e.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1662446157651-fd9d9bad-f924-4c19-b706-7b94d20751e8.jpeg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662448203808-f82a4bb4-6eaf-4977-983e-42209e1b1c15.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662449255433-9315d09c-e752-4ffb-a975-a54c856796e5.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662453084252-763866a8-f74d-4938-ba88-bbc2fbf85920.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662456538724-b365a830-e9dc-4472-aa8f-07e69371008c.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662457953619-1679fb5f-23fb-43cb-b34a-54d1b3b0c4df.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662462012337-424061e8-e1fc-4cbb-8c49-b6072ca68056.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662894067034-48b18544-3caf-4c99-91aa-9fa3207eafb4.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662903500575-0654dcc3-7084-4f44-ad79-e535855ebe8b.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662904506911-91a30004-51d1-4dd8-8d03-5f7743d9caf4.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662904530240-a2695b2a-09bf-40cb-b75c-1f04e862b0fc.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1663151006797-58eaa2f3-bf49-4ff3-a493-fff785bfa05a.jpeg">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662907721684-7990ab06-9e4c-4c6c-b67b-ad04ef8a55c6.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662908992043-444da205-b539-4036-b02e-6c1672e64f00.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662909400591-181e6928-75f6-40a9-80a2-6f163109b91d.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662910427167-f2a84f0b-ff53-47e1-864e-38f05e15bfb4.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1663148352142-96a6a343-c4f3-4185-9b7b-b6724faf9e9b.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662968166386-06ffeb53-6b4a-4a4d-8281-26bb8f3838e1.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662969574165-f5ad5028-0b3c-4a82-a70f-8d978cf19362.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662977831761-d5da8f13-d551-454a-b69f-be6475114777.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662977805511-ffbb8962-4456-42fe-917c-ed310575d9b8.png">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978608482-02437102-37b2-45c2-9b98-042ba882c5c1.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978794016-4b5c68bf-d7e6-4765-a19d-029bce17351f.gif">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978984982-ce1af8a4-16a6-4aa0-8111-baa4e25bc5f8.gif">
<meta property="og:updated_time" content="2022-09-27T03:58:43.967Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="realize-at">
<meta name="twitter:description" content="èƒŒæ™¯ä¸€å¤©äº§å“å¤§å¤§å‘ boss æ±‡æŠ¥å®Œç ”å‘æˆæœå’Œäº§å“ä¸šç»©äº§å‡ºï¼Œè‹¥æœ‰æ‰€æ€çš„èµ°å‡ºæ¥ï¼ŒåŠ²ç›´å‘æˆ‘èµ°è¿‡æ¥ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬ã€‚äº§å“å¤§å¤§ï¼šboss å¯¹æˆ‘ä»¬çš„ç ”å‘æˆæœæŒºæ»¡æ„çš„ï¼Œbalabalaâ€¦ï¼ˆå†…å¿ƒ OSï¼šä¸å¬ï¼Œè®²é‡ç‚¹ï¼‰äº§å“å¤§å¤§ï¼šå’±ä»¬çš„å®¢æœ IM æ¡Œé¢å®¢æˆ·ç«¯ç°åœ¨å·²ç»æœ‰èƒ½åŠ›åšåˆ° 1 å¯¹å¤šæ¥å¾…åœ¨çº¿è®¿å®¢äº†ï¼Œåé¢æˆ‘ä»¬æƒ³è¦å°†ä¸“é¡¹é—®é¢˜è®¿å®¢åœ¨å½“å‰æ¥å¾…å®¢æœä¸èƒ½è§£å†³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‹‰ä¸“é¡¹å®¢æœå‘èµ·ç¾¤èŠã€‚æˆ‘ï¼šå—¯ï¼Œè¿™ä¸ªæƒ³æ³•ä¸é”™ï¼Œä¸“é¡¹å®¢æœè¿˜èƒ½ä¸€">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389649885-df19671d-6b75-4375-8ea1-310481544199.gif">






  <link rel="canonical" href="https://wuwhs.gitee.io/2022/09/15/realize-at/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>realize-at | wuwh's blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa314f7747528620032d3194b7fccc9a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wuwh's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Make progress every day</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="åˆ‡æ¢å¯¼èˆªæ ">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />é¦–é¡µ</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />æ ‡ç­¾<span class="badge">39</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />åˆ†ç±»<span class="badge">12</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />å½’æ¡£<span class="badge">71</span></a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />æœç´¢</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="æœç´¢..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wuwhs.gitee.io/2022/09/15/realize-at/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuwhs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wuwh's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">realize-at
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              

              
                
              

              <time title="åˆ›å»ºæ—¶é—´ï¼š2022-09-15 17:08:30" itemprop="dateCreated datePublished" datetime="2022-09-15T17:08:30+08:00">2022-09-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">æ›´æ–°äº</span>
                
                <time title="ä¿®æ”¹æ—¶é—´ï¼š2022-09-27 11:58:43" itemprop="dateModified" datetime="2022-09-27T11:58:43+08:00">2022-09-27</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>ä¸€å¤©äº§å“å¤§å¤§å‘ boss æ±‡æŠ¥å®Œç ”å‘æˆæœå’Œäº§å“ä¸šç»©äº§å‡ºï¼Œè‹¥æœ‰æ‰€æ€çš„èµ°å‡ºæ¥ï¼ŒåŠ²ç›´å‘æˆ‘èµ°è¿‡æ¥ï¼Œå˜´è§’å¾®å¾®ä¸Šæ‰¬ã€‚<br>äº§å“å¤§å¤§ï¼šboss å¯¹æˆ‘ä»¬çš„ç ”å‘æˆæœæŒºæ»¡æ„çš„ï¼Œbalabalaâ€¦ï¼ˆå†…å¿ƒ OSï¼šä¸å¬ï¼Œè®²é‡ç‚¹ï¼‰<br>äº§å“å¤§å¤§ï¼šå’±ä»¬çš„å®¢æœ IM æ¡Œé¢å®¢æˆ·ç«¯ç°åœ¨å·²ç»æœ‰èƒ½åŠ›åšåˆ° 1 å¯¹å¤šæ¥å¾…åœ¨çº¿è®¿å®¢äº†ï¼Œåé¢æˆ‘ä»¬æƒ³è¦å°†ä¸“é¡¹é—®é¢˜è®¿å®¢åœ¨å½“å‰æ¥å¾…å®¢æœä¸èƒ½è§£å†³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æ‹‰ä¸“é¡¹å®¢æœå‘èµ·ç¾¤èŠã€‚<br>æˆ‘ï¼šå—¯ï¼Œè¿™ä¸ªæƒ³æ³•ä¸é”™ï¼Œä¸“é¡¹å®¢æœè¿˜èƒ½ä¸€çœ¼çœ‹åˆ°ä¹‹å‰å¯¹è¯ä¸Šä¸‹æ–‡ï¼Œè®¿å®¢è¿˜æ— é¡»é‡æ–°å‘èµ·èŠå¤©ã€‚<br>å“’å“’å“’ï¼ŒåŠŸèƒ½åšå®Œäº†ï¼Œä¸¤å‘¨åä¸Šçº¿éªŒæ”¶ï¼Œå®¢æˆ·å¾ˆæ»¡æ„ï¼Œboss åœ¨ç¾¤é‡Œä¹Ÿç‚¹äº†ä¸ª ğŸ‘ğŸ»ã€‚<br>äº§å“å¤§å¤§åˆæ¥äº†ï¼šå—¯ï¼Œè¿™ä¸ªåŠŸèƒ½ä¸é”™ï¼Œæˆ‘ä»¬ä¹Ÿæ”¯æŒç»™å®¢æœè‡ªå·±ç¾¤èŠå§ï¼Œæœ‰åŠ©äºå®¢æœç¾¤ä½“æ²Ÿé€šå’Œé—®é¢˜åé¦ˆã€‚<br>æˆ‘ï¼šå—¯ï¼Œè¿™ä¸ªæƒ³æ³•ä¹Ÿä¸é”™ï¼Œç¾¤èŠçš„å†…å®¹ä¹Ÿæœ‰åŠ©äºåæœŸçš„ç”¨æˆ·å£°éŸ³æ•°æ®æŒ–æ˜ã€‚<br>å“å“å“ï¼Œåšå¥½äº†ï¼Œä¸Šçº¿ï¼Œè°ƒæ•´å¥½å¿ƒæ€ï¼Œé™ç­‰è¢«å„è·¯å¤§ä½¬ ğŸ‘ğŸ» æ·¹æ²¡ã€‚<br>å®¢æœ Aï¼šææ¯›å•Šï¼Œä½ ä»¬ç¾¤èŠéƒ½ä¸ç»™ä¸ª@åŠŸèƒ½ï¼Œæˆ‘æ€ä¹ˆ diao ä½ ä»¬ç ”å‘å•Šã€‚<br>å®¢æœ B/C/Dï¼šâ•10086ã€‚<br>æˆ‘ï¼šã€‚ã€‚ã€‚<br>å“ˆå“ˆå“ˆï¼Œä¸Šé¢çš„è™šæ‹Ÿåœºæ™¯çº¯å±å¥½ç©ï¼Œä¸‹é¢å°±æ€æ ·å®Œç¾çš„å®ç°ä¸€ä¸ª@åŠŸèƒ½å±•å¼€ï¼ŒåŒ…æ•™åŒ…ä¼šã€‚<br>åœ¨è¿›å…¥æ­£é¢˜ä¹‹å‰ï¼Œå’±ä»¬å…ˆé¢„å¤‡ä¸€äº›å¯¹å…‰æ ‡é€‰åŒºçš„â€œåŸºæ“â€çŸ¥è¯†ã€‚è€Œå¯¹å…‰æ ‡é€‰åŒºçš„æ“ä½œåœ¨é¡µé¢ä¸Šçš„å…ƒç´ å¤§è‡´åˆ†ä¸ºä¸¤å¤§ç±»ï¼štext/textarea æ–‡æœ¬è¾“å…¥æ¡†å…ƒç´ å’Œå¯Œæ–‡æœ¬å…ƒç´ ã€‚ä¸‹é¢åˆ†åˆ«å¯¹ä¸€äº›å¸¸ç”¨ API è¿›è¡Œç®€å•ä»‹ç»ã€‚</p>
<h2 id="text-textarea-æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº"><a href="#text-textarea-æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº" class="headerlink" title="text/textarea æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº"></a>text/textarea æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº</h2><p>é¦–å…ˆçœ‹è¿™ç±»æ“ä½œæ–¹å¼ï¼Œå‡ ä¹å¯ä»¥ä¸ç”¨ <code>Selection</code>å’Œ <code>Range</code>ç›¸å…³ APIï¼Œä½¿ç”¨çš„æ˜¯æ–‡æœ¬è¾“å…¥æ¡†å…ƒç´ åŸç”Ÿæ–¹æ³•ã€‚</p>
<h3 id="ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ"><a href="#ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ" class="headerlink" title="ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ"></a>ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ</h3><p>ä¸»åŠ¨é€‰ä¸­åœ¨æ–‡æœ¬è¾“å…¥æ¡†å…ƒç´ æŸä¸€åŒºåŸŸå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/HTMLInputElement/setSelectionRange" target="_blank" rel="noopener">setSelectionRange</a> ã€‚</p>
<blockquote>
<p>element.setSelectionRange(selectionStart, selectionEnd [, selectionDirection]);</p>
</blockquote>
<ul>
<li>selectionStart è¢«é€‰ä¸­çš„ç¬¬ä¸€ä¸ªå­—ç¬¦çš„ä½ç½®ç´¢å¼•ï¼Œä» 0 å¼€å§‹ã€‚</li>
<li>selectionEnd è¢«é€‰ä¸­çš„æœ€åä¸€ä¸ªå­—ç¬¦çš„ ä¸‹ä¸€ä¸ª ä½ç½®ç´¢å¼•ã€‚</li>
<li>selectionDirection é€‰æ‹©æ–¹å‘çš„å­—ç¬¦ä¸²ã€‚</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$input.setSelectionRange(<span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line"><span class="comment">// $input.select() // å…¨éƒ¨é€‰ä¸­</span></span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389649885-df19671d-6b75-4375-8ea1-310481544199.gif" alt="setSelectionRange.gif"></p>
<h3 id="èšç„¦åˆ°æŸä¸€ä½ç½®"><a href="#èšç„¦åˆ°æŸä¸€ä½ç½®" class="headerlink" title="èšç„¦åˆ°æŸä¸€ä½ç½®"></a>èšç„¦åˆ°æŸä¸€ä½ç½®</h3><p>å¦‚æœæˆ‘ä»¬æƒ³æŠŠå…‰æ ‡ç§»åŠ¨åˆ° ğŸ˜ƒğŸ˜„ğŸ˜ åé¢ï¼Œå…¶å®æ˜¯å°†é€‰åŒºèµ·å§‹ä½ç½®è®¾ç½®ç›¸åŒçš„æ•ˆæœ</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$input.setSelectionRange(<span class="number">6</span>, <span class="number">6</span>)</span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389674758-aec15344-10ed-40a0-be3c-34cd2cde513b.gif" alt="setSelectionRange1.gif"></p>
<h3 id="è¿˜åŸä¹‹å‰çš„é€‰åŒº"><a href="#è¿˜åŸä¹‹å‰çš„é€‰åŒº" class="headerlink" title="è¿˜åŸä¹‹å‰çš„é€‰åŒº"></a>è¿˜åŸä¹‹å‰çš„é€‰åŒº</h3><p>æœ‰äº›åœºæ™¯ï¼Œæˆ‘ä»¬é€‰æ‹©äº†å½“å‰<code>input</code>æ–‡æœ¬æ¡†é€‰åŒºï¼Œè¦å»åšåˆ«çš„æ“ä½œï¼Œå›æ¥åè¦æ¢å¤é€‰åŒºï¼Œè¿™æ—¶åœ¨åšåˆ«çš„æ“ä½œä¹‹å‰å°±è¦å°†é€‰åŒºä½ç½®å­˜ä¸‹æ¥ï¼Œä¼šç”¨åˆ°<code>selectionStart</code>å’Œ <code>selectionEnd</code>ä¸¤ä¸ªå±æ€§ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$input.addEventListener(<span class="string">'mouseup'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">this</span>.pos = &#123;</span><br><span class="line">    start: $input.selectionStart,</span><br><span class="line">    end: $input.selectionEnd</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; start, end &#125; = <span class="keyword">this</span>.pos</span><br><span class="line">$input.setSelectionRange(start, end)</span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389710497-a13651e7-3f6e-40d5-82dd-f2f4b9ad5901.gif" alt="setSelectionRange2.gif"></p>
<h3 id="åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹"><a href="#åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹" class="headerlink" title="åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹"></a>åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹</h3><p>æŒ‡å®šæ–‡æœ¬è¾“å…¥æ¡†çš„æŸä¸ªä½ç½®æ’å…¥å†…å®¹æˆ–è€…æ›¿æ¢é€‰åŒºçš„å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/setRangeText" target="_blank" rel="noopener">setRangeText</a> å®ç°ã€‚</p>
<blockquote>
<p>setRangeText(replacement)<br>setRangeText(replacement, start, end, selectMode)</p>
</blockquote>
<p>è¿™ä¸ªæ–¹æ³•æœ‰ 2 ç§å½¢å¼ï¼Œç¬¬äºŒç§å½¢å¼æœ‰ 4 ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°<code>replacement</code>æ˜¯æ›¿æ¢æ–‡æœ¬ï¼›</li>
<li><code>start</code>å’Œ <code>end</code>æ˜¯èµ·å§‹ä½ç½®ï¼Œé»˜è®¤å€¼è¯¥å…ƒç´ å½“å‰é€‰ä¸­çš„åŒºåŸŸçš„ä½ç½®ï¼›</li>
<li>æœ€åä¸€ä¸ªå‚æ•°<code>selectMode</code>æ˜¯æ›¿æ¢åé€‰åŒºçš„çŠ¶æ€ï¼Œå®ƒæœ‰ 4 ä¸ªçŠ¶æ€ï¼šselectï¼ˆæ›¿æ¢åé€‰ä¸­ï¼‰ã€startï¼ˆæ›¿æ¢åå…‰æ ‡ä½äºæ›¿æ¢è¯ä¹‹å‰ï¼‰ã€endï¼ˆæ›¿æ¢åå…‰æ ‡ä½äºæ›¿æ¢è¯ä¹‹åï¼‰å’Œ preserveï¼ˆé»˜è®¤å€¼ï¼Œå°è¯•ä¿ç•™é€‰åŒºï¼‰ï¼›</li>
</ul>
<p>æˆ‘ä»¬å°†å…‰æ ‡æˆ–è€…é€‰åŒºä½ç½®æ’å…¥æˆ–è€…æ›¿æ¢æ–‡æœ¬ ğŸ˜‚ğŸ˜‚ğŸ˜‚ï¼Œå¯ä»¥è¿™æ ·</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$input.setRangeText(<span class="string">'ğŸ˜‚ğŸ˜‚ğŸ˜‚'</span>)</span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389727309-4831ce20-3bea-4b0c-9bec-86219a9c6427.gif" alt="setRangeText.gif"><br>ä¸‹é¢å†æ¥çœ‹çœ‹ç¬¬äºŒç§æœ‰ 4 ä¸ªå‚æ•°å½¢å¼ï¼Œå‘ç°ä¼šåœ¨æˆ‘ä»¬æŒ‡å®šçš„èµ·å§‹ä½ç½®æ’å…¥å†…å®¹åï¼Œå½“å‰çš„é€‰åŒºå’Œå…‰æ ‡å°è¯•ä¿ç•™ã€‚æ›¿æ¢åé€‰åŒºçš„çŠ¶æ€å¦å¤– 3 ç§åœºæ™¯å¤§å®¶å¯ä»¥è‡ªè¡Œæµ‹è¯•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$input.setRangeText(<span class="string">'ğŸ˜‚ğŸ˜‚ğŸ˜‚'</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="string">'preserve'</span>)</span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662389742937-1b7b8b0c-2e1d-482a-8e45-f86b3c01620a.gif" alt="setRangeText1.gif"><br>å…³äºé€‰åŒºçš„æ“ä½œåœ¨ input/textarea è¾“å…¥æ¡†ä¸­çš„æ“ä½œå¸¸ç”¨çš„å·®ä¸å¤šå°±è¿™äº›ï¼Œä¸‹é¢ç®€å•æ€»ç»“ä¸€ä¸‹<br><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1663148689420-1c042136-3b5a-4f15-ab7f-0c706a62568e.jpeg" alt=""></p>
<h2 id="å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection-amp-Range"><a href="#å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection-amp-Range" class="headerlink" title="å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection &amp; Range"></a>å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection &amp; Range</h2><h3 id="è®¾ç½®å¯Œæ–‡æœ¬"><a href="#è®¾ç½®å¯Œæ–‡æœ¬" class="headerlink" title="è®¾ç½®å¯Œæ–‡æœ¬"></a>è®¾ç½®å¯Œæ–‡æœ¬</h3><p>é¦–å…ˆå¯Œæ–‡æœ¬å…ƒç´ æ˜¯å¯ç¼–è¾‘å…ƒç´ ï¼Œå¯ä»¥åœ¨å…ƒç´ ä¸Šçœ‹åˆ°å…‰æ ‡ï¼Œé™¤äº†è¡¨å•å…ƒç´ ï¼Œè¿˜æœ‰ç»™æ™®é€šå…ƒç´ æ·»åŠ å±æ€§å¯ä»¥è½¬æ¢æ–‡å¯Œæ–‡æœ¬å…ƒç´ ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸‹ä¸‰ç§æ–¹å¼è½¬æ¢ã€‚</p>
<ul>
<li>ç»™å…ƒç´ æ·»åŠ å±æ€§ <code>contenteditable=&quot;true&quot;</code>ï¼›</li>
<li>æ·»åŠ  CSS å±æ€§ <code>-webkit-user-modify: &quot;read-write&quot;</code>ï¼›</li>
<li>é€šè¿‡ js çš„ <code>document.designMode=&quot;on&quot;</code>æ–¹å¼è®¾ç½®ï¼›</li>
</ul>
<h3 id="Selection-amp-Range"><a href="#Selection-amp-Range" class="headerlink" title="Selection &amp; Range"></a>Selection &amp; Range</h3><p>åœ¨å¯Œæ–‡æœ¬ä¸­å¯¹å…‰æ ‡åŠé€‰åŒºçš„æ“ä½œï¼Œä¸å¾—ä¸æ JavaScript çš„ä¸¤ä¸ªåŸç”Ÿå¯¹è±¡ï¼š <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection" target="_blank" rel="noopener">Selection</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/Range" target="_blank" rel="noopener">Range</a> ã€‚</p>
<ul>
<li><strong>Selection</strong> å¯¹è±¡è¡¨ç¤ºç”¨æˆ·é€‰æ‹©çš„æ–‡æœ¬èŒƒå›´æˆ–æ’å…¥ç¬¦å·çš„å½“å‰ä½ç½®ã€‚å®ƒä»£è¡¨é¡µé¢ä¸­çš„æ–‡æœ¬é€‰åŒºï¼Œå¯èƒ½æ¨ªè·¨å¤šä¸ªå…ƒç´ ã€‚æ–‡æœ¬é€‰åŒºç”±ç”¨æˆ·æ‹–æ‹½é¼ æ ‡ç»è¿‡æ–‡å­—è€Œäº§ç”Ÿã€‚è¦è·å–ç”¨äºæ£€æŸ¥æˆ–ä¿®æ”¹çš„ <code>Selection</code> å¯¹è±¡ï¼Œè¯·è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/getSelection" target="_blank" rel="noopener">window.getSelection()</a>ã€‚</li>
<li><strong>Range</strong> å¯¹è±¡è¡¨ç¤ºåŒ…å«èŠ‚ç‚¹å’Œéƒ¨åˆ†æ–‡æœ¬èŠ‚ç‚¹çš„æ–‡æ¡£ç‰‡æ®µã€‚é€šè¿‡ <code>selection</code>å¯¹è±¡è·å¾—çš„ <code>range</code>å¯¹è±¡æ‰æ˜¯æˆ‘ä»¬æ“ä½œå…‰æ ‡çš„é‡ç‚¹ã€‚</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662215604275-69e9f544-0b5a-4ba1-acf7-2d6a49928d03.png" alt="image.png"><br>å¤§å®¶å¯èƒ½æ³¨æ„åˆ° <code>getRangeAt(0)</code>ï¼Œé€‰åŒºå¯èƒ½ä¼šæœ‰å¤šä¸ª <code>range</code>? è¿˜çœŸæ˜¯ï¼Œåœ¨ Firefox æ”¯æŒå¤šä¸ªé€‰åŒºï¼Œé€šè¿‡ <code>cmd</code>é”®ï¼ˆ<code>windows</code>ä¸Šæ˜¯ <code>ctrl</code>é”®ï¼‰å¯ä»¥å®ç°å¤šé€‰åŒºã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662216141776-85c105ca-898d-4821-b132-cd703eaab3df.png" alt="image.png"><br>å†çœ‹ä¸€ä¸ª range è¿”å›çš„ä¸€ä¸ªå±æ€§ï¼Œ<code>collapsed</code>ï¼Œè¡¨ç¤ºé€‰åŒºçš„èµ·ç‚¹ä¸ç»ˆç‚¹æ˜¯å¦é‡å ã€‚å½“<code>collapsed</code>ä¸º<code>true</code>æ—¶ï¼Œé€‰ä¸­åŒºåŸŸè¢«å‹ç¼©æˆä¸€ä¸ªç‚¹ï¼Œå¯¹äºæ™®é€šçš„å…ƒç´ ï¼Œå¯èƒ½ä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ï¼Œå¦‚æœæ˜¯åœ¨å¯ç¼–è¾‘å…ƒç´ ä¸Šï¼Œé‚£è¿™ä¸ªè¢«å‹ç¼©çš„ç‚¹å°±å˜æˆäº†å¯ä»¥é—ªçƒçš„å…‰æ ‡ã€‚</p>
<h3 id="ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹"><a href="#ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹" class="headerlink" title="ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹"></a>ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹</h3><p>é€‰ä¸­å¯Œæ–‡æœ¬ä¸­çš„æŸä¸ªç‹¬ç«‹æ ‡ç­¾ï¼Œå¯ä»¥ç”¨åˆ°ä¸¤ä¸ª APIï¼Œ<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/selectNode" target="_blank" rel="noopener">Range.selectNode()</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/selectNodeContents" target="_blank" rel="noopener">Range.selectNodeContent()</a>ï¼Œä¸¤è€…ä¸åŒçš„æ˜¯å‰è€…åŒ…æ‹¬èŠ‚ç‚¹è‡ªèº«ï¼Œåè€…ä¸åŒ…æ‹¬è‡ªèº«ã€‚æ¯”å¦‚æˆ‘ä»¬æƒ³ç‹¬ç«‹é€‰ä¸­å¯Œæ–‡æœ¬çš„ç¬¬äºŒä¸ªå­å…ƒç´ <code>&lt;span style=&quot;color: #00965e;&quot;&gt;Selection&lt;/span&gt;</code> ï¼Œä½¿ç”¨ <code>Range.selectNode()</code> API é€‰ä¸­å…ƒç´ ï¼Œåˆ é™¤çš„æ˜¯æ•´ä¸ªå…ƒç´ ï¼Œå†è¾“å…¥å†…å®¹æ˜¯æ²¡æœ‰æ ·å¼çš„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $span = $input.childNodes[<span class="number">1</span>]</span><br><span class="line">range.selectNode($span)</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(range)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662435977354-b19ed561-61ec-4d8f-a184-9ae73f1f9b07.gif" alt="selectNode1.gif"><br>å½“ç„¶éƒ¨åˆ†æµè§ˆå™¨ï¼ˆæ¯”å¦‚ Chrome104ï¼‰æ˜¯æœ‰å·®å¼‚çš„ï¼Œåœ¨åˆ é™¤æ•´ä¸ªèŠ‚ç‚¹åï¼Œæ–°è¾“å…¥çš„å†…å®¹æ—¶ä¼šæ’å…¥ä¸€ä¸ªæ ‡ç­¾ï¼ˆ<code>font</code>ï¼‰å¹¶é›†æˆä¹‹å‰çš„æ ·å¼ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662436107528-1001e4af-e644-4571-8d26-ee085792e019.gif" alt="selectNode.gif"><br>ä½¿ç”¨ <code>Range.selectNodeContents()</code> API é€‰ä¸­çš„æ˜¯èŠ‚ç‚¹å†…éƒ¨å†…å®¹ï¼Œå½“åˆ é™¤é€‰ä¸­å†…å®¹åï¼ŒèŠ‚ç‚¹æœ¬èº«è¿˜åœ¨ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $span = $input.childNodes[<span class="number">1</span>]</span><br><span class="line">range.selectNodeContents($span)</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(range)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662436465512-d56fa927-a301-4e5a-b039-5e32c4443b07.gif" alt="selectNode2.gif"><br>ä»¥ä¸Šæ˜¯å¯¹å¯Œæ–‡æœ¬ä¸­å•ä¸ªèŠ‚ç‚¹çš„é€‰ä¸­æ“ä½œï¼Œç„¶è€Œï¼Œå®é™…ä¸Šå¯Œæ–‡æœ¬ä¸­çš„èŠ‚ç‚¹å¯èƒ½æ˜¯åµŒå¥—æˆ–è€…å¹³è¡Œçš„ï¼Œæ€æ ·è·¨å¤šä¸ªå…ƒç´ å»é€‰ä¸­æ“ä½œå‘¢ï¼Ÿ</p>
<h3 id="ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ"><a href="#ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ" class="headerlink" title="ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ"></a>ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ</h3><p>è¡¨å•è¾“å…¥æ¡†åªæœ‰å•ä¸€æ–‡æœ¬ï¼Œè€Œå¯Œæ–‡æœ¬å…ƒç´ æˆ–è€…æ™®é€šå…ƒç´ åŒ…å«å¤šä¸ªå…ƒç´ ã€‚å½“ä¸»åŠ¨é€‰ä¸­é¡µé¢æŸä¸€åŒºåŸŸï¼Œå…ˆè¦åˆ›å»ºä¸€ä¸ª<code>Range</code>å¯¹è±¡ï¼Œå¯èƒ½ä¼šè·¨å¤šä¸ªå…ƒç´ ï¼Œæ‰€ä»¥è¦è®¾ç½®é€‰åŒºçš„èµ·å§‹èŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/setStart" target="_blank" rel="noopener">Range.setStart()</a> å’Œ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/setEnd" target="_blank" rel="noopener">Range.setEnd()</a> æ–¹æ³•ã€‚</p>
<blockquote>
<p>range.setStart(startNode, startOffset);<br>range.setEnd(endNode, endOffset);</p>
</blockquote>
<ul>
<li>startNode å¼€å§‹èŠ‚ç‚¹</li>
<li>startOffset ä» startNode çš„å¼€å§‹ä½ç½®ç®—èµ·çš„åç§»é‡</li>
<li>endNode ç»“æŸèŠ‚ç‚¹</li>
<li>endOffset ä» endNode çš„ç»“æŸä½ç½®ç®—èµ·çš„åç§»é‡</li>
</ul>
<p>ä¸Šé¢æ˜¯è®¾ç½®é€‰åŒºèŒƒå›´ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°é€‰åŒºå¹¶é€‰ä¸­ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/addRange" target="_blank" rel="noopener">Selection.addRange()</a>ã€‚ä¸è¿‡ï¼Œä¸€èˆ¬åœ¨æ·»åŠ å‰ï¼Œä¼šæ¸…é™¤ä¹‹å‰çš„é€‰åŒºï¼Œè¿™æ—¶å°±è¦ç”¨åˆ° <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Selection/removeAllRanges" target="_blank" rel="noopener">Selection.removeAllRanges()</a> ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">range.setStart($input.firstChild, <span class="number">0</span>)</span><br><span class="line">range.setEnd($input.firstChild, <span class="number">4</span>)</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(range)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662390599870-23189fbe-5149-43dc-8492-5d06e425464e.gif" alt="addRange.gif"><br>æ³¨æ„è¿™é‡Œå–å¯Œæ–‡æœ¬å…ƒç´ çš„ç¬¬ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆæ–‡æœ¬èŠ‚ç‚¹ï¼‰ï¼Œè€Œä¸æ˜¯å…ƒç´ æœ¬èº«ï¼Œå¦åˆ™å°±ä¼šè¶…å‡ºåç§»é‡ï¼Œå‡ºç°æŠ¥é”™ã€‚å› ä¸ºåœ¨è®¡ç®—å…ƒç´ èŠ‚ç‚¹å’Œæ–‡æœ¬èŠ‚ç‚¹åç§»é‡æ˜¯æœ‰å·®åˆ«çš„ï¼š</p>
<blockquote>
<p>å¦‚æœèµ·å§‹èŠ‚ç‚¹ç±»å‹æ˜¯ Textã€Comment æˆ– CDATASection ä¹‹ä¸€ï¼Œé‚£ä¹ˆ startOffset æŒ‡çš„æ˜¯ä»èµ·å§‹èŠ‚ç‚¹ç®—èµ·å­—ç¬¦çš„åç§»é‡ã€‚ å¯¹äºå…¶ä»– Node ç±»å‹èŠ‚ç‚¹ï¼ŒstartOffset æ˜¯æŒ‡ä»èµ·å§‹ç»“ç‚¹å¼€å§‹ç®—èµ·å­èŠ‚ç‚¹çš„åç§»é‡ã€‚</p>
</blockquote>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚æœæˆ‘æƒ³é€‰ä¸­å¯Œæ–‡æœ¬å¼€å¤´è¿™ä¸€æ®µ <code>ğŸ˜ƒğŸ˜„ğŸ˜&lt;span style=&quot;color: #00965e;&quot;&gt;Selection&lt;/span&gt; å¯¹è±¡</code>ï¼Œæ€æ ·å®ç°å‘¢ï¼Ÿ<br>å¯¹äºæ¯”è¾ƒå¤æ‚çš„å¯Œæ–‡æœ¬å…ƒç´ ç»“æ„ï¼Œè¦å®ç°ä»»æ„åŒºé—´é€‰ä¸­ï¼Œå…³é”®è¦æ‰¾åˆ°èµ·å§‹èŠ‚ç‚¹å’Œç»“æŸèŠ‚ç‚¹ï¼Œä»¥åŠå®ƒä»¬å„è‡ªçš„åç§»é‡ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1662446157651-fd9d9bad-f924-4c19-b706-7b94d20751e8.jpeg" alt=""></p>
<p>å¥½åƒæ²¡æœ‰æ›´å¥½çš„åŸç”Ÿæ–¹æ³•å¯ä»¥å€ŸåŠ©ï¼Œè¿™é‡Œæœ‰ä¸€ç§æ–¹æ¡ˆï¼Œé¦–å…ˆéå†å‡ºå¯Œæ–‡æœ¬åŒ…å«æ‰€æœ‰çš„æ–‡æœ¬èŠ‚ç‚¹ï¼Œç„¶åè®°å½•æ¯ä¸ªèŠ‚ç‚¹è¾¹ç•Œçš„åç§»é‡ï¼ŒæŸ¥æ‰¾å‡ºæ»¡è¶³åŒºé—´æ¡ä»¶çš„èµ·å§‹å’Œç»“æŸèŠ‚ç‚¹ï¼Œæœ€åä»èµ·å§‹å’Œç»“æŸèŠ‚ç‚¹ä¸­è®¡ç®—å„è‡ªéœ€è¦çš„æ–‡æœ¬åç§»é‡ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–æ‰€æœ‰æ–‡æœ¬èŠ‚ç‚¹åŠå…¶åç§»é‡</span></span><br><span class="line"><span class="comment"> * @param &#123;HTMLElement&#125; wrapDom æœ€å¤–å±‚èŠ‚ç‚¹</span></span><br><span class="line"><span class="comment"> * @param &#123;Number&#125; start å¼€å§‹ä½ç½®</span></span><br><span class="line"><span class="comment"> * @param &#123;Number&#125; end ç»“æŸä½ç½®</span></span><br><span class="line"><span class="comment"> * @returns</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getNodeAndOffset</span>(<span class="params">wrapDom, start = <span class="number">0</span>, end = <span class="number">0</span></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> txtList = []</span><br><span class="line">  <span class="keyword">const</span> map = <span class="function"><span class="keyword">function</span> (<span class="params">children</span>) </span>&#123;</span><br><span class="line">    ;[...children].forEach(<span class="function">(<span class="params">el</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (el.nodeName === <span class="string">'#text'</span>) &#123;</span><br><span class="line">        txtList.push(el)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        map(el.childNodes)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// é€’å½’éå†ï¼Œæå–å‡ºæ‰€æœ‰ #text</span></span><br><span class="line">  map(wrapDom.childNodes)</span><br><span class="line">  <span class="comment">// è®¡ç®—æ–‡æœ¬çš„ä½ç½®åŒºé—´</span></span><br><span class="line">  <span class="keyword">const</span> clips = txtList.reduce(<span class="function">(<span class="params">arr, item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> end = item.textContent.length + (arr[index - <span class="number">1</span>] ? arr[index - <span class="number">1</span>][<span class="number">2</span>] : <span class="number">0</span>)</span><br><span class="line">    arr.push([item, end - item.textContent.length, end])</span><br><span class="line">    <span class="keyword">return</span> arr</span><br><span class="line">  &#125;, [])</span><br><span class="line">  <span class="comment">// æŸ¥æ‰¾æ»¡è¶³æ¡ä»¶çš„èŒƒå›´åŒºé—´</span></span><br><span class="line">  <span class="keyword">const</span> startNode = clips.find(<span class="function">(<span class="params">el</span>) =&gt;</span> start &gt;= el[<span class="number">1</span>] &amp;&amp; start &lt; el[<span class="number">2</span>])</span><br><span class="line">  <span class="keyword">const</span> endNode = clips.find(<span class="function">(<span class="params">el</span>) =&gt;</span> end &gt;= el[<span class="number">1</span>] &amp;&amp; end &lt; el[<span class="number">2</span>])</span><br><span class="line">  <span class="keyword">return</span> [startNode[<span class="number">0</span>], start - startNode[<span class="number">1</span>], endNode[<span class="number">0</span>], end - endNode[<span class="number">1</span>]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æœ‰äº†è¿™ä¸ªæˆ‘ä»¬è‡ªå·±å°è£…çš„å·¥å…·æ–¹æ³•ï¼Œå°±å¯ä»¥é€‰ä¸­ä»»æ„æ–‡å­—åŒºé—´ï¼Œè€Œä¸ç”¨è€ƒè™‘å¯Œæ–‡æœ¬çš„å…ƒç´ ç»“æ„ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line"><span class="keyword">const</span> nodes = <span class="keyword">this</span>.getNodeAndOffset($input, <span class="number">4</span>, <span class="number">17</span>)</span><br><span class="line">range.setStart(nodes[<span class="number">0</span>], nodes[<span class="number">1</span>])</span><br><span class="line">range.setEnd(nodes[<span class="number">2</span>], nodes[<span class="number">3</span>])</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(range)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662448203808-f82a4bb4-6eaf-4977-983e-42209e1b1c15.gif" alt="getNodeAndOffset.gif"></p>
<h3 id="èšç„¦åˆ°æŸä¸€ä½ç½®-1"><a href="#èšç„¦åˆ°æŸä¸€ä½ç½®-1" class="headerlink" title="èšç„¦åˆ°æŸä¸€ä½ç½®"></a>èšç„¦åˆ°æŸä¸€ä½ç½®</h3><p>é€šè¿‡ä¸Šé¢å·²å®ç°é€‰ä¸­ä»»æ„åŒºé—´æ–‡å­—ï¼Œå†æ¥çœ‹å°†å…‰æ ‡èšç„¦åˆ°æŸä¸€ä½ç½®ï¼Œå°±ç®€å•å¤šäº†ï¼Œåªé€‰å°†èµ·å§‹å’Œç»“æŸèŒƒå›´ä½ç½®è®¾ç½®ç›¸åŒå³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line"><span class="keyword">const</span> nodes = <span class="keyword">this</span>.getNodeAndOffset($input, <span class="number">7</span>, <span class="number">7</span>)</span><br><span class="line">range.setStart(nodes[<span class="number">0</span>], nodes[<span class="number">1</span>])</span><br><span class="line">range.setEnd(nodes[<span class="number">2</span>], nodes[<span class="number">3</span>])</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(range)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662449255433-9315d09c-e752-4ffb-a975-a54c856796e5.gif" alt="getNodeAndOffset1.gif"></p>
<h3 id="è¿˜åŸä¹‹å‰çš„é€‰åŒº-1"><a href="#è¿˜åŸä¹‹å‰çš„é€‰åŒº-1" class="headerlink" title="è¿˜åŸä¹‹å‰çš„é€‰åŒº"></a>è¿˜åŸä¹‹å‰çš„é€‰åŒº</h3><p>åŒæ–‡æœ¬è¾“å…¥æ¡†ä¿å­˜å½“å‰çš„å…‰æ ‡ä½ç½®ï¼Œåœ¨å¯Œæ–‡æœ¬é‡Œï¼Œå¯ä»¥å°†æ•´ä¸ªé€‰åŒºéƒ½ä¿å­˜ä¸‹æ¥ï¼Œç„¶ååœ¨åé¢å¤åŸé€‰åŒºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¿å­˜å…‰æ ‡</span></span><br><span class="line">$input.addEventListener(<span class="string">'mouseup'</span>, () =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line">  <span class="keyword">const</span> range = selection.getRangeAt(<span class="number">0</span>)</span><br><span class="line">  <span class="keyword">this</span>.lastRange = range</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// è¿˜åŸå…‰æ ‡</span></span><br><span class="line"><span class="keyword">const</span> selection = <span class="built_in">document</span>.getSelection()</span><br><span class="line"><span class="keyword">const</span> range = <span class="built_in">document</span>.createRange()</span><br><span class="line">selection.removeAllRanges()</span><br><span class="line">selection.addRange(<span class="keyword">this</span>.lastRange)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662453084252-763866a8-f74d-4938-ba88-bbc2fbf85920.gif" alt="addRange1.gif"></p>
<h3 id="åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹-1"><a href="#åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹-1" class="headerlink" title="åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹"></a>åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹</h3><p>åœ¨é€‰åŒºæ’å…¥å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/insertNode" target="_blank" rel="noopener">Range.insertNode()</a> æ–¹æ³•ï¼Œå®ƒè¡¨ç¤ºåœ¨é€‰åŒºçš„èµ·ç‚¹å¤„æ’å…¥ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶ä¸”ä¸ä¼šæ›¿æ¢å½“å‰å·²ç»é€‰ä¸­çš„ï¼Œå¦‚æœéœ€è¦æ›¿æ¢ï¼Œå¯ä»¥å…ˆåˆ é™¤ï¼Œåˆ é™¤é€‰åŒºå¯ä»¥ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/deleteContents" target="_blank" rel="noopener">Range.deleteContent()</a> æ–¹æ³•ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $text = <span class="built_in">document</span>.createTextNode(<span class="string">'ğŸ˜‚ğŸ˜‚ğŸ˜‚'</span>)</span><br><span class="line"><span class="keyword">this</span>.lastRange.deleteContents()</span><br><span class="line"><span class="keyword">this</span>.lastRange.insertNode($text)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662456538724-b365a830-e9dc-4472-aa8f-07e69371008c.gif" alt="deleteContent.gif"><br>ä»ä¸Šé¢å®¢æœå‘ç°ï¼Œæ’å…¥å†…å®¹åï¼Œå†…å®¹æ˜¯è¢«é€‰åŒºé€‰ä¸­çŠ¶æ€ï¼Œå¦‚æœå¸Œæœ›å…‰æ ‡åœ¨æ’å…¥çš„å†…å®¹åé¢ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setStartAfter" target="_blank" rel="noopener">Range.setStartAfter()</a> è®¾ç½®é€‰åŒºçš„èµ·ç‚¹ä¸ºå…ƒç´ çš„åé¢ï¼Œé»˜è®¤é€‰åŒºçš„ç»ˆç‚¹åœ¨å…ƒç´ çš„åé¢ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setEndAfter" target="_blank" rel="noopener">Range.setEndAfter()</a>ï¼Œæ— é¡»è®¾ç½®ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.lastRange.setStartAfter($text)</span><br><span class="line">$input.focus()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662457953619-1679fb5f-23fb-43cb-b34a-54d1b3b0c4df.gif" alt="setStartAfter.gif"><br>åŒæ ·ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setEndBefore" target="_blank" rel="noopener">Range.setEndBefore</a> å’Œ <a href="https://developer.mozilla.org/en-US/docs/Web/API/Range/setStartBefore" target="_blank" rel="noopener">setStartBefore</a>å°†å…‰æ ‡è®¾ç½®åˆ°å†…å®¹çš„å‰é¢ã€‚</p>
<h3 id="ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾"><a href="#ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾" class="headerlink" title="ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾"></a>ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾</h3><p>è¿˜æœ‰ä¸€äº›æ¯”è¾ƒé«˜çº§çš„ç”¨æ³•åº”ç”¨ï¼Œæ¯”å¦‚ç»™æŸå¥è¯åŠ èƒŒæ™¯æ ‡è®°æ•ˆæœï¼Œç±»ä¼¼ word æ–‡æ¡£æ–‡å­—é€‰ä¸­åŠ èƒŒæ™¯è‰²ã€‚å¯ä»¥é€šè¿‡ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/surroundContents" target="_blank" rel="noopener">Range.surroundContents()</a> æ–¹æ³•å®ç°ã€‚</p>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662462012337-424061e8-e1fc-4cbb-8c49-b6072ca68056.gif" alt="surroundContents.gif"><br>ä¸è¿‡ï¼Œå½“é€‰åŒºåŒ…å«å¤šä¸ªå…ƒç´ ï¼Œä¹Ÿå°±æ˜¯æ–­å¼€äº†ä¸€ä¸ªé text èŠ‚ç‚¹ï¼ŒåªåŒ…å«äº†èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªè¾¹ç•Œï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚<br>é‚£ä¹ˆæ€æ ·å¯ä»¥è§„é¿è¿™ä¸ªé—®é¢˜ï¼Œå®ç°è·¨å¤šä¸ªèŠ‚ç‚¹é€‰ä¸­æ ‡è®°å‘¢ï¼Ÿç­”æ¡ˆæ˜¯ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/extractContents" target="_blank" rel="noopener">extractContents()</a>ï¼Œå®ƒä¼šå°†æˆ‘ä»¬çš„é€‰åŒºå¤šèŠ‚ç‚¹ç§»åŠ¨åˆ° <code>DocumentFragment</code> å¯¹è±¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯</p>
<blockquote>
<p>ä½¿ç”¨ DOM äº‹ä»¶æ·»åŠ çš„äº‹ä»¶ç›‘å¬å™¨åœ¨æå–æœŸé—´ä¸ä¼šä¿ç•™ã€‚HMTL å±æ€§äº‹ä»¶å°†æŒ‰ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Node/cloneNode" target="_blank" rel="noopener">Node.cloneNode()</a> æ–¹æ³•åŸæ ·ä¿ç•™å’Œå¤åˆ¶ã€‚HTML id å±æ€§ä¹Ÿä¼šè¢«å…‹éš†ï¼Œå¦‚æœæå–äº†éƒ¨åˆ†é€‰å®šçš„èŠ‚ç‚¹å¹¶å°†å…¶é™„åŠ åˆ°æ–‡æ¡£ä¸­ï¼Œåˆ™å¯èƒ½å¯¼è‡´æ— æ•ˆçš„æ–‡æ¡£ã€‚</p>
</blockquote>
<p>ç”¨æ ‡ç­¾åŒ…è£¹è¯¥æ–‡æ¡£ç‰‡æ®µï¼Œç„¶åæ’å…¥ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> $mark = <span class="built_in">document</span>.createElement(<span class="string">'mark'</span>)</span><br><span class="line"><span class="comment">// this.lastRange.surroundContents($mark)</span></span><br><span class="line"><span class="keyword">const</span> fragments = <span class="keyword">this</span>.lastRange.extractContents()</span><br><span class="line">$mark.append(fragments)</span><br><span class="line"><span class="keyword">this</span>.lastRange.insertNode($mark)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662894067034-48b18544-3caf-4c99-91aa-9fa3207eafb4.gif" alt="extractContents.gif"></p>
<h3 id="å…‰æ ‡-é€‰åŒºçš„ä½ç½®åæ ‡"><a href="#å…‰æ ‡-é€‰åŒºçš„ä½ç½®åæ ‡" class="headerlink" title="å…‰æ ‡/é€‰åŒºçš„ä½ç½®åæ ‡"></a>å…‰æ ‡/é€‰åŒºçš„ä½ç½®åæ ‡</h3><p>æœ‰æ—¶æˆ‘ä»¬æƒ³ç¡®å®šæ–‡æœ¬åŒºåŸŸä¸­è¢«é€‰ä¸­çš„éƒ¨åˆ†æˆ–è€…å…‰æ ‡çš„è§†çª—åæ ‡ï¼Œä»¥æ­¤å¯ä»¥å°†ç±»ä¼¼å¤‡æ³¨æˆ–è€…æ‚¬æµ®æ¡†å®šä½åˆ°é™„è¿‘ã€‚è¿™é‡Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/getBoundingClientRect" target="_blank" rel="noopener">Range.getBoundingClientRect()</a> APIï¼Œå®ƒè¿”å›ä¸€ä¸ª DOMRect å¯¹è±¡ï¼Œè¯¥å¯¹è±¡å°†èŒƒå›´ä¸­çš„å†…å®¹åŒ…å›´èµ·æ¥ï¼›å³è¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªå°†èŒƒå›´å†…æ‰€æœ‰<br>å…ƒç´ åŒ…å›´èµ·æ¥çš„çŸ©å½¢ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> pos = <span class="keyword">this</span>.lastRange.getBoundingClientRect()</span><br><span class="line"><span class="keyword">const</span> highlight = <span class="built_in">document</span>.getElementById(<span class="string">'highlight'</span>)</span><br><span class="line">highlight.style.left = <span class="string">`<span class="subst">$&#123;pos.x&#125;</span>px`</span></span><br><span class="line">highlight.style.top = <span class="string">`<span class="subst">$&#123;pos.y&#125;</span>px`</span></span><br><span class="line">highlight.style.width = <span class="string">`<span class="subst">$&#123;pos.width&#125;</span>px`</span></span><br><span class="line">highlight.style.height = <span class="string">`<span class="subst">$&#123;pos.height&#125;</span>px`</span></span><br></pre></td></tr></table></figure>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-id">#highlight</span> &#123;</span><br><span class="line">  <span class="attribute">position</span>: absolute;</span><br><span class="line">  <span class="attribute">background-color</span>: aqua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662903500575-0654dcc3-7084-4f44-ad79-e535855ebe8b.gif" alt="getBoundingClientRect.gif"><br>é€‰ä¸­äº† 3 è¡Œï¼Œä½†ä¸æ˜¯å®Œæ•´çš„ 3 è¡Œï¼Œç»™å›çš„ä¿¡æ¯æ˜¯ä¸€ä¸ªæœ€å°åŒ…è£¹é€‰åŒºçš„çŸ©å½¢ä½ç½®åæ ‡ï¼Œå¦‚æœè¿˜éœ€è¦çŸ¥é“é€‰å–ä¸­æ¯ä¸ªå…ƒç´ æ›´è¯¦ç»†çš„ä½ç½®åæ ‡ï¼Œå¯ä»¥ä½¿ç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Range/getClientRects" target="_blank" rel="noopener">Range.getClientRects()</a>ï¼Œå®ƒè¿”å›çš„æ˜¯ä¸€ä¸ª DOMRect å¯¹è±¡åˆ—è¡¨ï¼Œè¡¨ç¤º Range åœ¨å±å¹•ä¸Šæ‰€å çš„åŒºåŸŸã€‚è¿™ä¸ªåˆ—è¡¨ç›¸å½“äºæ±‡é›†äº†èŒƒå›´ä¸­æ‰€æœ‰å…ƒç´ è°ƒç”¨ <a href="https://developer.mozilla.org/zh-CN/docs/Web/API/Element/getClientRects" target="_blank" rel="noopener">Element.getClientRects()</a>æ–¹æ³•æ‰€å¾—åˆ°çš„ç»“æœã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.lastRange.getClientRects()</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662904506911-91a30004-51d1-4dd8-8d03-5f7743d9caf4.png" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662904530240-a2695b2a-09bf-40cb-b75c-1f04e862b0fc.png" alt="image.png"><br>Selection&amp;Range çš„ API å¾ˆå¤šï¼Œå¸¸ç”¨çš„å¤§è‡´ä»¥ä¸Šåˆ—ä¸¾çš„ï¼ŒåŒæ ·ç®€å•æ€»ç»“ä¸€ä¸‹<br><img src="https://cdn.nlark.com/yuque/0/2022/jpeg/22627045/1663151006797-58eaa2f3-bf49-4ff3-a493-fff785bfa05a.jpeg" alt=""></p>
<h2 id="çš„åŠŸèƒ½å®ç°"><a href="#çš„åŠŸèƒ½å®ç°" class="headerlink" title="@çš„åŠŸèƒ½å®ç°"></a>@çš„åŠŸèƒ½å®ç°</h2><p>å¦‚æœä½ å·²ç»ç†Ÿæ‚‰äº†ä¸Šé¢çš„ã€ŒåŸºæ“ã€ï¼Œé‚£ä¹ˆå¯¹äºå®ç°ä¸€ä¸ª@åŠŸèƒ½å·²ç»æˆåŠŸäº†ä¸€åŠï¼Œå‰©ä¸‹çš„ä¸€åŠå°±æ˜¯æ€è·¯äº†ï¼Œå¤§è‡´åˆ†ä¸ºå¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ol>
<li>ç›‘å¬ç”¨æˆ·è¾“å…¥äº†<code>@</code>å­—ç¬¦ï¼Œå±•ç¤ºç”¨æˆ·åˆ—è¡¨ï¼›</li>
<li>ç‚¹å‡»ç”¨æˆ·ï¼Œå¯¼è‡´è¾“å…¥æ¡†å¤±ç„¦ï¼ŒåŠæ—¶ä¿å­˜å…‰æ ‡ä¿¡æ¯ï¼›</li>
<li>ç‚¹å‡»å®Œæˆï¼Œç”¨æˆ·åˆ—è¡¨éšè—ï¼Œæ¢å¤è¾“å…¥æ¡†çš„å…‰æ ‡ï¼Œç„¶ååœ¨å…‰æ ‡åæ’å…¥ç”¨æˆ·åï¼›</li>
</ol>
<p>é¦–å…ˆæˆ‘ä»¬å†™å¥½ <code>HTML</code>ï¼Œ<code>CSS</code> éƒ¨åˆ†åœ¨è¿™é‡Œçœç•¥</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- å¯Œæ–‡æœ¬èŠå¤©æ¶ˆæ¯è¾“å…¥æ¡† --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span></span></span><br><span class="line"><span class="tag">  <span class="attr">class</span>=<span class="string">"chat-input"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">ref</span>=<span class="string">"chatInput"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">contenteditable</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">  <span class="attr">placeholder</span>=<span class="string">"è¯·è¾“å…¥å†…å®¹"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">input</span>=<span class="string">"inputChatContent"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">blur</span>=<span class="string">"chatContentBlur"</span></span></span><br><span class="line"><span class="tag">  @<span class="attr">mouseup</span>=<span class="string">"chatContentMouseup"</span></span></span><br><span class="line"><span class="tag">&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- ç”¨æˆ·åˆ—è¡¨æµ®çª— --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"popper"</span> <span class="attr">v-show</span>=<span class="string">"isShowUserList"</span> <span class="attr">ref</span>=<span class="string">"popper"</span> <span class="attr">:style</span>=<span class="string">"popperStyle"</span> <span class="attr">v-click-out-hide</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">"(item, index) in userList"</span> <span class="attr">:key</span>=<span class="string">"index"</span> @<span class="attr">click</span>=<span class="string">"selectUser(item)"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">el-row</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">el-row</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>æ¥ç€æˆ‘ä»¬ç›‘å¬å¯Œæ–‡æœ¬çš„<code>input</code>äº‹ä»¶ï¼Œå½“ç›‘å¬åˆ° @ å­—ç¬¦ï¼Œå±•ç¤ºç”¨æˆ·åˆ—è¡¨ï¼Œå¦åˆ™éšè—ã€‚äºæ­¤åŒæ—¶ï¼Œä½¿ç”¨ Range.getBoundingClientRect() è·å–å…‰æ ‡çš„ä½ç½®ï¼Œè¿™æ ·æ‰èƒ½å°†ç”¨æˆ·åˆ—è¡¨æµ®æ¡†å®šä½åˆ°å…‰æ ‡é™„è¿‘ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å…¥èŠå¤©å†…å®¹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; ev</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">inputChatContent(ev) &#123;</span><br><span class="line">  <span class="keyword">if</span> (ev.data === <span class="string">'@'</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="keyword">this</span>.getCaretPos()</span><br><span class="line">    <span class="keyword">this</span>.showUserList()</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setUserListPos(pos)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.hideUserList()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è·å–å…‰æ ‡ä½ç½®</span></span><br><span class="line"><span class="comment"> * @returns</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">getCaretPos() &#123;</span><br><span class="line">  <span class="keyword">const</span> range = <span class="keyword">this</span>.getRange()</span><br><span class="line">  <span class="keyword">const</span> pos = range.getBoundingClientRect()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> pos</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è®¾ç½®ç”¨æˆ·åˆ—è¡¨çš„ä½ç½®</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; pos</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">setUserListPos(pos) &#123;</span><br><span class="line">  <span class="keyword">const</span> $popper = <span class="keyword">this</span>.$refs.popper</span><br><span class="line">  <span class="keyword">const</span> panelWidth = $popper.offsetWidth</span><br><span class="line">  <span class="keyword">const</span> panelHeight = $popper.offsetHeight</span><br><span class="line">  <span class="keyword">const</span> &#123; x, y &#125; = pos</span><br><span class="line"></span><br><span class="line">  <span class="keyword">this</span>.popperStyle = &#123;</span><br><span class="line">    top: y - panelHeight - <span class="number">20</span> + <span class="string">'px'</span>,</span><br><span class="line">    left: x - panelWidth / <span class="number">2</span> + <span class="string">'px'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">hideUserList() &#123;</span><br><span class="line">  <span class="keyword">this</span>.isShowUserList = <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">showUserList() &#123;</span><br><span class="line">  <span class="keyword">this</span>.isShowUserList = <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>å½“ç‚¹å‡»ç”¨æˆ·åˆ—è¡¨æ—¶ï¼Œè¾“å…¥æ¡†ä¼šå¤±ç„¦ï¼Œæ­¤æ—¶å…ˆå°†å…‰æ ‡ä¿å­˜èµ·æ¥ï¼ŒåŒæ—¶åˆ›å»ºå°†è¦æ’å…¥çš„ç”¨æˆ·åæ–‡æœ¬èŠ‚ç‚¹ï¼Œç„¶åæ¢å¤å…‰æ ‡ï¼Œå† <code>Range.insetNode()</code> å°†ç”¨æˆ·åæ–‡æœ¬èŠ‚ç‚¹ <code>Range.insetNode()</code> æ’å…¥åˆ°é€‰åŒºï¼Œæœ€å <code>Selection.removeAllRanges()</code> ç§»é™¤æ‰€æœ‰é¡µé¢é€‰åŒºï¼Œ<code>Selection.addRange()</code> æ’å…¥å½“å‰é€‰åŒºã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * é€‰æ‹©ç”¨æˆ·</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">selectUser(user) &#123;</span><br><span class="line">  <span class="comment">// è®©å¤±ç„¦äº‹ä»¶å…ˆæ‰§è¡Œ</span></span><br><span class="line">  setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.hideUserList()</span><br><span class="line">    <span class="keyword">this</span>.insertContent(user)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ¢å¤å…‰æ ‡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">restoreCaret() &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.lastRange) &#123;</span><br><span class="line">    <span class="keyword">const</span> selection = <span class="built_in">window</span>.getSelection()</span><br><span class="line">    selection.removeAllRanges()</span><br><span class="line">    selection.addRange(<span class="keyword">this</span>.lastRange)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥å†…å®¹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">insertContent(data) &#123;</span><br><span class="line">  <span class="keyword">this</span>.restoreCaret() <span class="comment">// è¿˜åŸå…‰æ ‡</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selection = <span class="built_in">window</span>.getSelection()</span><br><span class="line">  <span class="keyword">const</span> range = selection.getRangeAt(<span class="number">0</span>)</span><br><span class="line">  range.collapse(<span class="literal">false</span>) <span class="comment">// æŠ˜å é€‰åŒºï¼Œå…‰æ ‡ç§»åˆ°æœ€å</span></span><br><span class="line">  range.insertNode(data.content)</span><br><span class="line">  range.collapse(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  selection.removeAllRanges()</span><br><span class="line">  selection.addRange(range)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662907721684-7990ab06-9e4c-4c6c-b67b-ad04ef8a55c6.gif" alt="at1.gif"></h2><h2 id="åŠŸèƒ½åŠ å¼ºç‰ˆ"><a href="#åŠŸèƒ½åŠ å¼ºç‰ˆ" class="headerlink" title="@åŠŸèƒ½åŠ å¼ºç‰ˆ"></a>@åŠŸèƒ½åŠ å¼ºç‰ˆ</h2><p>ä»¥ä¸Šæ˜¯ç®€å•å®ç°äº†@ åŠŸèƒ½ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿˜æœ‰æ›´å¤šæå‡ç”¨æˆ·ä½“éªŒçš„åœ°æ–¹</p>
<ul>
<li>å½“å‰é€šè¿‡é€€å›é”®åˆ é™¤ç”¨æˆ·å<code>@xxx</code>ï¼Œå‘ç°åˆ é™¤çš„æ˜¯é€ä¸ªå­—ç¬¦ï¼Œè€Œç”¨æˆ·æ›´å¤šæƒ³è¦çš„æ˜¯æŒ‰ä¸€ä¸‹é€€å›é”®ï¼Œåˆ é™¤æ•´ä¸ªç”¨æˆ·åï¼›</li>
<li>å‘é€å‡ºå»æ€æ ·è§£ææˆåç«¯èƒ½è¯†åˆ«çš„ç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œå¹¶ä¸”ç‰¹å®šçš„æ•°æ®ç»“æ„æ€æ ·è½¬æ¢å›å¯Œæ–‡æœ¬å‘¢ï¼Ÿ</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662908992043-444da205-b539-4036-b02e-6c1672e64f00.gif" alt="at2.gif"><br>æš‚ä¸”å¸¦è¿™ä¸¤ä¸ªé—®é¢˜ï¼Œæ¥ç€æ€æ ·è§£å†³å‘¢ï¼Ÿ</p>
<h3 id="å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å"><a href="#å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å" class="headerlink" title="å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å"></a>å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å</h3><p>é¦–å…ˆæƒ³åˆ°çš„æ˜¯ç”¨æˆ·åæ’å…¥å¯Œæ–‡æœ¬æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼ŒæŒ‰ä¸€ä¸‹é€€å›é”®ï¼Œå°±èƒ½åˆ é™¤æ•´ä¸ªæ ‡ç­¾ï¼Ÿç­”æ¡ˆæ˜¯ä¸èƒ½ï¼Œå¯Œæ–‡æœ¬æ ‡ç­¾é‡Œçš„æ–‡å­—åœ¨æ²¡æœ‰é€‰ä¸­æƒ…å†µä¸‹éƒ½æ˜¯é€ä¸ªåˆ é™¤ã€‚é™¤éè¯¥å…ƒç´ æ˜¯ä¸å¯ç¼–è¾‘å…ƒç´  <code>span.contentEditable = false</code>ã€‚<br><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662909400591-181e6928-75f6-40a9-80a2-6f163109b91d.gif" alt="at3.gif"><br>è¿™é‡Œè¦å°† <code>@xxx</code>æ”¾å…¥ä¸å¯ç¼–è¾‘æ ‡ç­¾ä¸­ï¼Œåˆ é™¤çš„æ—¶å€™æ‰èƒ½ä¸€èµ·åˆ ã€‚æ­¤æ—¶ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡æ’å…¥ç”¨æˆ·æ ‡ç­¾åï¼Œå¤šå‡ºä¸€ä¸ª@ å­—ç¬¦ï¼Œæ‰€ä»¥åœ¨ä¹‹å‰å·²ç»è¾“å…¥çš„ @ å­—ç¬¦å°±éœ€è¦åœ¨æ’å…¥æ ‡ç­¾å‰éœ€è¦åˆ é™¤æ‰ã€‚å…·ä½“å®ç°æ˜¯æ‰¾åˆ°é€‰åŒºæ‰€åœ¨çš„å¼€å§‹èŠ‚ç‚¹ <code>Range.startContainer</code>ï¼Œå†æ‰¾åˆ°é€‰åŒºç»“æŸä½ç½®çš„åç§»é‡ <code>Range.endOffset</code> ï¼Œæ­£å¸¸æƒ…å†µä¸‹é€‰åŒºç»“æŸä½ç½®çš„å‰ä¸€ä¸ªå°±æ˜¯ @å­—ç¬¦ï¼Œé€‰ä¸­åˆ é™¤å³å¯ã€‚</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ é™¤è¾“å…¥æ¡†ä¸­å…‰æ ‡ä½ç½®ç°æœ‰çš„@å­—ç¬¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">deleteCaretAtCode() &#123;</span><br><span class="line">  <span class="keyword">const</span> range = <span class="keyword">this</span>.getRange()</span><br><span class="line">  <span class="comment">// å…‰æ ‡å¼€å§‹èŠ‚ç‚¹å’Œå…‰æ ‡åœ¨èŠ‚ç‚¹ä¸Šçš„åç§»é‡ï¼Œæ‰¾åˆ°å…‰æ ‡å‡†ç¡®ä½ç½®ï¼Œé€‰ä¸­å…‰æ ‡ä½ç½®å‰ä¸€ä¸ªå­—ç¬¦èŒƒå›´å¹¶åˆ é™¤ï¼Œ</span></span><br><span class="line">  <span class="keyword">const</span> node = range.startContainer</span><br><span class="line">  <span class="keyword">const</span> end = range.endOffset</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¼€å§‹èŠ‚ç‚¹å†…å®¹æœ€åä¸€ä¸ªå­—ç¬¦æ˜¯@ï¼Œåˆ é™¤ï¼Œå¦åˆ™ä¸åˆ é™¤</span></span><br><span class="line">  <span class="keyword">if</span> (node.textContent[end - <span class="number">1</span>] === <span class="string">'@'</span>) &#123;</span><br><span class="line">    range.setStart(node, end ? end - <span class="number">1</span> : <span class="number">0</span>)</span><br><span class="line">    range.deleteContents()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è½¬æ¢è¦æ’å…¥å…‰æ ‡ä½ç½®çš„å†…å®¹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">parseContent(data) &#123;</span><br><span class="line">  <span class="keyword">const</span> &#123; type = <span class="string">'text'</span>, name &#125; = data</span><br><span class="line">  <span class="keyword">let</span> content = <span class="literal">null</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// type æ˜¯æ’å…¥å†…å®¹ç±»å‹ï¼Œå¯èƒ½æ˜¯æ–‡æœ¬ã€@æ ‡ç­¾ã€å›¾ç‰‡ã€è¡¨æƒ…ç­‰</span></span><br><span class="line">  <span class="keyword">if</span> (type === <span class="string">'text'</span>) &#123;</span><br><span class="line">    content = <span class="built_in">document</span>.createTextNode(name)</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (type === <span class="string">'at'</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ é™¤è¾“å…¥æ¡†ä¸­å…‰æ ‡ä½ç½®ç°æœ‰çš„@å­—ç¬¦</span></span><br><span class="line">    <span class="keyword">this</span>.deleteCaretAtCode()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> $span = <span class="built_in">document</span>.createElement(<span class="string">'span'</span>)</span><br><span class="line">    $span.contentEditable = <span class="literal">false</span></span><br><span class="line">    $span.classList.add(<span class="string">'tag'</span>)</span><br><span class="line">    $span.innerHTML = <span class="string">`@<span class="subst">$&#123;name&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ’å…¥ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ï¼ˆ\u0010ï¼‰åˆ°@æ ‡ç­¾åé¢ï¼Œå¯ä»¥è§£å†³éƒ¨åˆ†æµè§ˆå™¨ä¸Šå…‰æ ‡åœ¨èŠå¤©è¾“å…¥æ¡†åé¢</span></span><br><span class="line">    <span class="keyword">const</span> $space = <span class="built_in">document</span>.createTextNode(<span class="string">'\u0010'</span>)</span><br><span class="line">    <span class="keyword">const</span> frag = <span class="built_in">document</span>.createDocumentFragment()</span><br><span class="line"></span><br><span class="line">    frag.appendChild($span)</span><br><span class="line">    frag.appendChild($space)</span><br><span class="line"></span><br><span class="line">    content = frag</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> content</span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line"> <span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æ’å…¥å†…å®¹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; data</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">insertContent(data) &#123;</span><br><span class="line">  <span class="keyword">this</span>.restoreCaret() <span class="comment">// è¿˜åŸå…‰æ ‡</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> selection = <span class="built_in">window</span>.getSelection()</span><br><span class="line">  <span class="keyword">const</span> range = selection.getRangeAt(<span class="number">0</span>)</span><br><span class="line">  range.collapse(<span class="literal">false</span>) <span class="comment">// æŠ˜å é€‰åŒºï¼Œå…‰æ ‡ç§»åˆ°æœ€å</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> pc = <span class="keyword">this</span>.parseContent(data)</span><br><span class="line">  range.insertNode(pc)</span><br><span class="line">  range.collapse(<span class="literal">false</span>)</span><br><span class="line"></span><br><span class="line">  selection.removeAllRanges()</span><br><span class="line">  selection.addRange(range)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662910427167-f2a84f0b-ff53-47e1-864e-38f05e15bfb4.gif" alt="at4.gif"></p>
<h3 id="ä¸€äº›å…¼å®¹å¤„ç†"><a href="#ä¸€äº›å…¼å®¹å¤„ç†" class="headerlink" title="ä¸€äº›å…¼å®¹å¤„ç†"></a>ä¸€äº›å…¼å®¹å¤„ç†</h3><p>å¯èƒ½ä½ å·²ç»æ³¨æ„åˆ°äº†ï¼Œåœ¨ç”¨æˆ·æ ‡ç­¾<code>@xxx</code>åé¢è¿½åŠ äº†ä¸€ä¸ªç©ºæ ¼å­—ç¬¦ï¼Œè¿™æ ·å…‰æ ‡å¯ä»¥æ˜¾ç¤ºå‡ºæ¥ï¼Œä¸è¿‡åœ¨ç”¨é€€æ ¼é”®éœ€è¦æŒ‰ä¸¤æ¬¡åˆ é™¤æ ‡ç­¾ï¼Œè¿™é‡Œå…·ä½“çš„è¦çœ‹ä¸šåŠ¡éœ€è¦äº†ã€‚<br>æ³¨æ„çš„æ˜¯åœ¨ Mac Chromeï¼ˆV104ï¼‰ä¸Šï¼Œå¦‚æœåœ¨æ ‡ç­¾åé¢ä¸è¿½åŠ å­—ç¬¦ï¼Œå…‰æ ‡ä¼šåœ¨å¤–å±‚å¯Œæ–‡æœ¬æ ‡ç­¾åé¢ï¼Œåœ¨éç¼–è¾‘æ ‡ç­¾ååŠ ä»»æ„å­—ç¬¦æ˜¯æ­£å¸¸çš„ã€‚<img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1663148352142-96a6a343-c4f3-4185-9b7b-b6724faf9e9b.gif" alt="chat-input-cursor-out.gif"><br>ç»è¿‡æµ‹è¯• Firefox æµè§ˆå™¨æœ‰è¿™æ ·çš„ bugï¼šç”¨æˆ·æ ‡ç­¾<code>@xxx</code>æ²¡æœ‰æ­£ç¡®çš„æ’å…¥åˆ°å¯Œæ–‡æœ¬è¾“å…¥æ¡†çš„ä½ç½®ï¼Œè€Œæ˜¯æ’å…¥åˆ°äº†ç”¨æˆ·åˆ—è¡¨ç‚¹å‡»çš„é‚£ä¸€é¡¹ä¸Šäº†ã€‚<img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662968166386-06ffeb53-6b4a-4a4d-8281-26bb8f3838e1.gif" alt="firefox.gif"><br>å¤§èƒ†æ¨æµ‹ Firefox å°†æ™®é€šå…ƒç´ ä¹Ÿå¯ä»¥è®¾ç½®å…‰æ ‡ï¼Œè¿™æ ·ç‚¹å‡»ç”¨æˆ·åˆ—è¡¨æŸä¸€é¡¹å…ƒç´ æ—¶ï¼Œè¯¥å…ƒç´ è·å¾—å…‰æ ‡ï¼Œå†è·å–æ–°é€‰åŒº <code>selection.getRangeAt(0)</code>å…¶å®æ˜¯åœ¨ç‚¹å‡»çš„è¿™ä¸ªå…ƒç´ ä¸Šï¼Œéæ¢å¤çš„å¯Œæ–‡æœ¬è¾“å…¥æ¡†ä¸Šï¼Œç„¶åæ’å…¥ç”¨æˆ·æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„æƒ…æ™¯ã€‚<br>è¿™é‡Œæˆ‘çš„è§£å†³æ–¹æ³•æ˜¯å°†ç”¨æˆ·åˆ—è¡¨é¡¹è®¾ç½®ä¸ºä¸å¯é€‰ä¸­çš„ï¼Œè‡ªç„¶å°±æ— æ³•è·å–å…‰æ ‡ã€‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.popper</span> <span class="selector-tag">li</span> &#123;</span><br><span class="line">  <span class="comment">/* ç”¨æˆ·ä¸èƒ½é€‰ä¸­æ–‡æœ¬ firfox éç¼–è¾‘ç¼–è¾‘å…ƒç´ ä¹Ÿå¯é€‰ä¸­ */</span></span><br><span class="line">  <span class="attribute">user-select</span>: none;</span><br><span class="line">  <span class="attribute">-webkit-user-select</span>: none;</span><br><span class="line">  <span class="attribute">list-style</span>: none;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">10px</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662969574165-f5ad5028-0b3c-4a82-a70f-8d978cf19362.gif" alt="Firefox1.gif"><br>æˆ‘ä»¬å†çœ‹çœ‹å† Safari ä¸Šçš„è¡¨ç°<br><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662977831761-d5da8f13-d551-454a-b69f-be6475114777.gif" alt="Safari1.gif"><br>å‘ç°æ˜¯æ²¡æœ‰æŒ‰ç…§é¢„æƒ³çš„åˆ é™¤æ‰å‰ç½®çš„<code>@</code>å­—ç¬¦çš„ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æœ‰æŠ¥é”™<br><img src="https://cdn.nlark.com/yuque/0/2022/png/22627045/1662977805511-ffbb8962-4456-42fe-917c-ed310575d9b8.png" alt="image.png"><br>å¤§è‡´æ„æ€æ˜¯ <code>selection.getRangeAt(0)</code>ä¸­ç¬¬ 0 ä½æ˜¯è¶…å‡ºå…è®¸çš„èŒƒå›´çš„ï¼Œéš¾é“åœ¨è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹çš„æƒ…æ™¯ä¸‹ï¼ŒSafari é»˜è®¤å°†é€‰åŒºç»™æ¸…ç©ºäº†ï¼Ÿé€šè¿‡å®éªŒå‘ç°ç¡®å®å¦‚æ­¤</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾“å…¥æ¡†å¤±å»ç„¦ç‚¹å’Œè·å–ç„¦ç‚¹æ—¶æ‰“å°é€‰åŒºä¸ªæ•°</span></span><br><span class="line"><span class="keyword">const</span> selection = <span class="built_in">window</span>.getSelection()</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'selection.rangeCount: '</span>, selection.rangeCount)</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978608482-02437102-37b2-45c2-9b98-042ba882c5c1.gif" alt="Safari2.gif"><br>è€Œæ­£å¸¸å…¶ä»–æµè§ˆå™¨é€‰åŒºä¸ªæ•°ä¿æŒä¸å˜<br><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978794016-4b5c68bf-d7e6-4765-a19d-029bce17351f.gif" alt="Safari3.gif"><br>é‚£æ€æ ·è§£å†³è¿™ç§æƒ…æ™¯å‘¢ï¼Ÿæˆ‘ä»¬æ˜¯åœ¨è¾“å…¥æ¡†å¤±ç„¦çš„æ—¶å€™ä¿å­˜é€‰åŒºçš„ï¼Œæ­¤æ—¶ Safari å·²ç»æ¸…ç©ºäº†é€‰åŒºï¼Œå¯¼è‡´è¿™ä¸ªæ—¶å€™ä¿å­˜çš„é€‰åŒºæ˜¯ç©ºçš„ï¼Œå› æ­¤æˆ‘ä»¬è¦å°†é€‰åŒºä¿å­˜å‰ç½®ä¸€ä¸‹ï¼Œåœ¨è¾“å…¥<code>@</code>å­—ç¬¦æ—¶å€™å°±ä¿å­˜ä¸€ä¸‹é€‰åŒºï¼ˆå…‰æ ‡ï¼‰ï¼Œå¯ä»¥è¿™æ ·åš</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * è¾“å…¥èŠå¤©å†…å®¹</span></span><br><span class="line"><span class="comment"> * @param &#123;*&#125; ev</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">inputChatContent(ev) &#123;</span><br><span class="line">  <span class="keyword">if</span> (ev.data === <span class="string">'@'</span>) &#123;</span><br><span class="line">    <span class="comment">// åœ¨è¾“å…¥@å­—ç¬¦æ—¶å€™å°±ä¿å­˜ä¸€ä¸‹å…‰æ ‡</span></span><br><span class="line">    <span class="keyword">this</span>.saveCaret()</span><br><span class="line">    <span class="keyword">const</span> pos = <span class="keyword">this</span>.getCaretPos()</span><br><span class="line">    <span class="keyword">this</span>.showUserList()</span><br><span class="line">    <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.setUserListPos(pos)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.hideUserList()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2022/gif/22627045/1662978984982-ce1af8a4-16a6-4aa0-8111-baa4e25bc5f8.gif" alt="Safari.gif"></p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æœ¬æ–‡ä»¥â€œå®Œç¾â€å®ç°ä¸€ä¸ª@ åŠŸèƒ½ä¸ºå¼•å­ï¼Œä»‹ç»äº† input/textarea æ–‡æœ¬è¾“å…¥æ¡†å’Œå¯Œæ–‡æœ¬çš„é€‰åŒºæ“ä½œã€‚å¹¶åœ¨æ­¤åŸºç¡€ä¸Šç»“åˆ@ åŠŸèƒ½çš„å®ç°æ€è·¯ï¼Œè¾¹å®è·µè¾¹æ”¹è¿›ï¼Œä¸ä¹æœ‰å¾ˆå¤šåœ°æ–¹æ²¡æœ‰è€ƒè™‘å‘¨å…¨çš„ï¼Œä»…å½“ä½œå­¦ä¹ çš„ demo å°±å¥½ï¼Œæ¬¢è¿æŒ‡æ­£ã€‚æœ¬æ–‡åœ¨çº¿æ¡ˆä¾‹å¯ä»¥ç‚¹<a href="https://wuwhs.gitee.io/demo/realize-at/">è¿™é‡Œ</a>ï¼Œå®Œï½</p>

      
    </div>

    
      


    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>æœ¬æ–‡ä½œè€…ï¼š </strong>wuwhs</li>
  <li class="post-copyright-link">
    <strong>æœ¬æ–‡é“¾æ¥ï¼š</strong>
    <a href="https://wuwhs.gitee.io/2022/09/15/realize-at/" title="realize-at">https://wuwhs.gitee.io/2022/09/15/realize-at/</a>
  </li>
  <li class="post-copyright-license">
    <strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/javascript-html5/" rel="tag"># javascript html5</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/12/01/style/" rel="next" title="ç»„å‘˜é‡æ„ä»£ç åƒå¥‡ç™¾æ€ªï¼Œç›´æ¥JSã€ES6å’ŒVueè§„èŒƒç»™ä¸€æ¢­å­">
                <i class="fa fa-chevron-left"></i> ç»„å‘˜é‡æ„ä»£ç åƒå¥‡ç™¾æ€ªï¼Œç›´æ¥JSã€ES6å’ŒVueè§„èŒƒç»™ä¸€æ¢­å­
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="wuwhs" />
            
              <p class="site-author-name" itemprop="name">wuwhs</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">71</span>
                    <span class="site-state-item-name">æ—¥å¿—</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">åˆ†ç±»</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">39</span>
                    <span class="site-state-item-name">æ ‡ç­¾</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wuwhs" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://segmentfault.com/u/wuwhs" target="_blank" title="Segmentfault" rel="external nofollow"><i class="fa fa-fw fa-globe"></i>Segmentfault</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#èƒŒæ™¯"><span class="nav-number">1.</span> <span class="nav-text">èƒŒæ™¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#text-textarea-æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº"><span class="nav-number">2.</span> <span class="nav-text">text/textarea æ–‡æœ¬è¾“å…¥æ¡†ä¸­æ“ä½œå…‰æ ‡é€‰åŒº</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ"><span class="nav-number">2.1.</span> <span class="nav-text">ä¸»åŠ¨é€‰ä¸­æŸä¸€åŒºåŸŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#èšç„¦åˆ°æŸä¸€ä½ç½®"><span class="nav-number">2.2.</span> <span class="nav-text">èšç„¦åˆ°æŸä¸€ä½ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿˜åŸä¹‹å‰çš„é€‰åŒº"><span class="nav-number">2.3.</span> <span class="nav-text">è¿˜åŸä¹‹å‰çš„é€‰åŒº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹"><span class="nav-number">2.4.</span> <span class="nav-text">åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection-amp-Range"><span class="nav-number">3.</span> <span class="nav-text">å¯Œæ–‡æœ¬ä¸­æ“ä½œå…‰æ ‡é€‰åŒºâ€”â€”Selection &amp; Range</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#è®¾ç½®å¯Œæ–‡æœ¬"><span class="nav-number">3.1.</span> <span class="nav-text">è®¾ç½®å¯Œæ–‡æœ¬</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Selection-amp-Range"><span class="nav-number">3.2.</span> <span class="nav-text">Selection &amp; Range</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹"><span class="nav-number">3.3.</span> <span class="nav-text">ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸ªèŠ‚ç‚¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ"><span class="nav-number">3.4.</span> <span class="nav-text">ä¸»åŠ¨é€‰ä¸­å¯Œæ–‡æœ¬çš„æŸä¸€åŒºåŸŸ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#èšç„¦åˆ°æŸä¸€ä½ç½®-1"><span class="nav-number">3.5.</span> <span class="nav-text">èšç„¦åˆ°æŸä¸€ä½ç½®</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#è¿˜åŸä¹‹å‰çš„é€‰åŒº-1"><span class="nav-number">3.6.</span> <span class="nav-text">è¿˜åŸä¹‹å‰çš„é€‰åŒº</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹-1"><span class="nav-number">3.7.</span> <span class="nav-text">åœ¨æŒ‡å®šé€‰åŒºæ’å…¥ï¼ˆæ›¿æ¢ï¼‰å†…å®¹</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾"><span class="nav-number">3.8.</span> <span class="nav-text">ç»™æŒ‡å®šé€‰åŒºåŒ…è£¹æ ‡ç­¾</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#å…‰æ ‡-é€‰åŒºçš„ä½ç½®åæ ‡"><span class="nav-number">3.9.</span> <span class="nav-text">å…‰æ ‡/é€‰åŒºçš„ä½ç½®åæ ‡</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#çš„åŠŸèƒ½å®ç°"><span class="nav-number">4.</span> <span class="nav-text">@çš„åŠŸèƒ½å®ç°</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#"><span class="nav-number">5.</span> <span class="nav-text"></span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#åŠŸèƒ½åŠ å¼ºç‰ˆ"><span class="nav-number">6.</span> <span class="nav-text">@åŠŸèƒ½åŠ å¼ºç‰ˆ</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å"><span class="nav-number">6.1.</span> <span class="nav-text">å®ç°æ•´ä½“åˆ é™¤ç”¨æˆ·å</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä¸€äº›å…¼å®¹å¤„ç†"><span class="nav-number">6.2.</span> <span class="nav-text">ä¸€äº›å…¼å®¹å¤„ç†</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">7.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 â€“ <span itemprop="copyrightYear">2023</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">copyright by wuwh's blog</span>

  

  
</div>


  










        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  













  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>

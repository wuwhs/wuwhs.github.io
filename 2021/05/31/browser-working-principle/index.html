<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-center-atom.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.4.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.4.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.4.0">


  <link rel="mask-icon" href="/images/logo.png?v=6.4.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.4.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="前言作为一名前端 er，日常工作打交道最多（之一）的莫过于熟悉而又陌生的浏览器了，熟悉是每天都会基于浏览器的应用层面之上码业务，陌生是很多人可能跟我一样不熟悉其内部运行原理，比如 js 是怎样运行的呢？精美样式页面是怎样渲染到电脑屏幕的呢？在开放的互联网它又是怎样保证我们个人信息安全的呢？带着种种疑云开始肝李兵老师的《浏览器基本原理与实践》，不得不说，大家之作，通俗易懂，层层拨开云雾见青天，下面就">
<meta name="keywords" content="浏览器">
<meta property="og:type" content="article">
<meta property="og:title" content="浏览器工作原理与实践">
<meta property="og:url" content="https://wuwhs.gitee.io/2021/05/31/browser-working-principle/index.html">
<meta property="og:site_name" content="wuwh&#39;s blog">
<meta property="og:description" content="前言作为一名前端 er，日常工作打交道最多（之一）的莫过于熟悉而又陌生的浏览器了，熟悉是每天都会基于浏览器的应用层面之上码业务，陌生是很多人可能跟我一样不熟悉其内部运行原理，比如 js 是怎样运行的呢？精美样式页面是怎样渲染到电脑屏幕的呢？在开放的互联网它又是怎样保证我们个人信息安全的呢？带着种种疑云开始肝李兵老师的《浏览器基本原理与实践》，不得不说，大家之作，通俗易懂，层层拨开云雾见青天，下面就">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2022-09-27T03:58:43.962Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="浏览器工作原理与实践">
<meta name="twitter:description" content="前言作为一名前端 er，日常工作打交道最多（之一）的莫过于熟悉而又陌生的浏览器了，熟悉是每天都会基于浏览器的应用层面之上码业务，陌生是很多人可能跟我一样不熟悉其内部运行原理，比如 js 是怎样运行的呢？精美样式页面是怎样渲染到电脑屏幕的呢？在开放的互联网它又是怎样保证我们个人信息安全的呢？带着种种疑云开始肝李兵老师的《浏览器基本原理与实践》，不得不说，大家之作，通俗易懂，层层拨开云雾见青天，下面就">






  <link rel="canonical" href="https://wuwhs.gitee.io/2021/05/31/browser-working-principle/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>浏览器工作原理与实践 | wuwh's blog</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?fa314f7747528620032d3194b7fccc9a";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta custom-logo">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">wuwh's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">Make progress every day</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签<span class="badge">37</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类<span class="badge">12</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档<span class="badge">70</span></a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://wuwhs.gitee.io/2021/05/31/browser-working-principle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="wuwhs">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="wuwh's blog">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">浏览器工作原理与实践
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2021-05-31 22:33:26" itemprop="dateCreated datePublished" datetime="2021-05-31T22:33:26+08:00">2021-05-31</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2022-09-27 11:58:43" itemprop="dateModified" datetime="2022-09-27T11:58:43+08:00">2022-09-27</time>
              
            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>作为一名前端 er，日常工作打交道最多（之一）的莫过于熟悉而又陌生的浏览器了，熟悉是每天都会基于浏览器的应用层面之上码业务，陌生是很多人可能跟我一样不熟悉其内部运行原理，比如 js 是怎样运行的呢？精美样式页面是怎样渲染到电脑屏幕的呢？在开放的互联网它又是怎样保证我们个人信息安全的呢？带着种种疑云开始肝李兵老师的《浏览器基本原理与实践》，不得不说，大家之作，通俗易懂，层层拨开云雾见青天，下面就（非常非常）简单总结一下。</p>
<h2 id="浏览器工作原理与实践"><a href="#浏览器工作原理与实践" class="headerlink" title="浏览器工作原理与实践"></a>浏览器工作原理与实践</h2><h3 id="Chrome-架构：仅仅打开了-1-个页面，为什么有-4-个进程"><a href="#Chrome-架构：仅仅打开了-1-个页面，为什么有-4-个进程" class="headerlink" title="Chrome 架构：仅仅打开了 1 个页面，为什么有 4 个进程"></a>Chrome 架构：仅仅打开了 1 个页面，为什么有 4 个进程</h3><p><strong>线程和进程区别</strong>：多线程可以并行处理任务，线程不能单独存在，它是由进程来启动和管理的。一个进程是一个程序的运行实例。</p>
<p><strong>线程和进程的关系</strong>：1、进程中任意一线程执行出错，都会导致整个进程的崩溃。2、线程之间共享进程中的数据。3、当一个进程关闭后，操作系统会回收进程所占用的内存。4、进程之间的内容相互隔离。</p>
<p><strong>单进程 浏览器</strong>：1、不稳定。单进程中的插件、渲染线程崩溃导致整个浏览器崩溃。2、不流畅。脚本（死循环）或插件会使浏览器卡顿。3、不安全。插件和脚本可以获取到操作系统任意资源。</p>
<p><strong>多进程浏览器</strong>：1、解决不稳定。进程相互隔离，一个页面或者插件崩溃时，影响仅仅时当前插件或者页面，不会影响到其他页面。2、解决不流畅。脚本阻塞当前页面渲染进程，不会影响到其他页面。3、解决不安全。采用多进程架构使用沙箱。沙箱看成时操作系统给进程上来一把锁，沙箱的程序可以运行，但是不能在硬盘上写入任何数据，也不能在敏感位置读取任何数据。</p>
<p><strong>多进程架构</strong>：分为 浏览器进程、渲染进程、GPU 进程、网络进程、插件进程。</p>
<p><strong>缺点</strong>：1、资源占用高。2、体系架构复杂。</p>
<p><strong>面向服务架构</strong>：把原来的各种模块重构成独立的服务，每个服务都可以在独立的进程中运行，访问服务必须使用定义好的接口，通过 IPC 通讯，使得系统更内聚、松耦合、易维护和拓展。</p>
<h3 id="TCP-协议：如何保证页面文件能被完整送达浏览器"><a href="#TCP-协议：如何保证页面文件能被完整送达浏览器" class="headerlink" title="TCP 协议：如何保证页面文件能被完整送达浏览器]"></a>TCP 协议：如何保证页面文件能被完整送达浏览器]</h3><ul>
<li>IP 头是 IP 数据包开头的信息，包含 IP 版本、源 IP 地址、目标 IP 地址、生存时间等信息；</li>
<li>UDP 头中除了目的端口，还有源端口号等信息；</li>
<li>IP 负责把数据包送达目的主机；</li>
<li>UDP 负责把数据包送达具体应用；</li>
<li>对于错误的数据包，UDP 不提供重发机制，只是丢弃当前的包，不能保证数据的可靠性，但是传输速度非常块；</li>
<li>TCP 头除了包含了目标端口和本机端口号外，还提供了用于排序的序列号，保证了数据完整地传输，它的连接可分为三个阶段：建立连接、传输数据和断开连接；</li>
</ul>
<h3 id="HTTP-请求流程：为什么很多站点第二次打开速度会很快"><a href="#HTTP-请求流程：为什么很多站点第二次打开速度会很快" class="headerlink" title="HTTP 请求流程：为什么很多站点第二次打开速度会很快"></a>HTTP 请求流程：为什么很多站点第二次打开速度会很快</h3><ul>
<li>浏览器中的 HTTP 请求从发起到结束一共经历如下八个阶段：构建请求、查找缓存、准备 IP 和端口、等待 TCP 队列、建立 TCP 连接、发起 HTTP 请求、服务器处理请求、服务器返回请求和断开连接；</li>
<li>构建请求。浏览器构建请求行，构建好后，准备发起网络请求；</li>
<li>查找缓存。在真正法器请求前浏览器会查询缓存中是否有请求资源副本，有则拦截请求，返回资源副本，否则进入网络请求；</li>
<li>准备 IP 地址和端口。HTTP 网络请求需要和服务器建立 TCP 连接，而建立 TCP 连接需要准备 IP 地址和端口号，浏览器需要请求 DNS 返回域名对应的 IP，同时会缓存域名解析结果，供下次查询使用；</li>
<li>等待 TCP 队列。Chrome 机制，同一个域名同时最多只能建立 6 个 TCP 连接；</li>
<li>建立 TCP 连接。TCP 通过“三次握手”建立连接，传输数据，“四次挥手”断开连接；</li>
<li>发送 HTTP 请求。建立 TCP 连接后，浏览器就可以和服务器进行 HTTP 数据传输了，首先会向服务器发送请求行，然后以请求头形式发送一些其他信息，如果是 POST 请求还会发送请求体；</li>
<li>服务器处理请求。首先服务器会返回响应行，随后，服务器向浏览器发送响应头和响应体。通常服务器返回数据，就要关闭 TCP 连接，如果请求头或者响应头有 Connection:keep-alive TCP 保持打开状态；</li>
</ul>
<h3 id="导航流程：从输入-URL-到页面展示这中间发生了什么"><a href="#导航流程：从输入-URL-到页面展示这中间发生了什么" class="headerlink" title="导航流程：从输入 URL 到页面展示这中间发生了什么"></a>导航流程：从输入 URL 到页面展示这中间发生了什么</h3><ul>
<li>用户输入 URL 并回车</li>
<li>浏览器进程检查 URL，组装协议，构成完整 URL</li>
<li>浏览器进程通过进程通信（IPC）把 URL 请求发送给网络进程</li>
<li>网络进程接收到 URL 请求后检查本地缓存是否缓存了该请求资源，如果有则将该资源返回给浏览器进程</li>
<li>如果没有，网络进程向 web 服务器发起 http 请求（网络请求），请求流程如下：<ul>
<li>进行 DNS 解析，获取服务器 IP 地址，端口</li>
<li>利用 IP 地址和服务器建立 tcp 连接</li>
<li>构建请求头信息</li>
<li>发送请求头信息</li>
<li>服务器响应后，网络进程接收响应头和响应信息，并解析响应内容</li>
</ul>
</li>
<li>网络进程解析响应流程：<ul>
<li>检查状态码，如果是 301/302，则需要重定向，从 Location 自动读取地址，重新进行第 4 步，如果是 200，则继续处理请求</li>
<li>200 响应处理：检查响应类型 Content-Type，如果是字节流类型，则将该请求提交给下载管理器，该导航流程结束，不再进行后续渲染。如果是 html 则通知浏览器进程准备渲染进程进行渲染</li>
</ul>
</li>
<li>准备渲染进程<ul>
<li>浏览器进程检查当前 URL 是否和之前打开的渲染进程根域名是否相同，如果相同，则复用原来的进程，如果不同，则开启新的渲染进程</li>
</ul>
</li>
<li>传输数据、更新状态<ul>
<li>渲染进程准备好后，浏览器向渲染进程发起“提交文档”的消息，渲染进程接收到消息和网络进程建立传输数据的“管道”</li>
<li>渲染进程接收完数据后，向浏览器发送“确认提交”</li>
<li>浏览器进程接收到确认消息后 engine 浏览器界面状态：安全、地址 URL、前进后退的历史状态、更新 web 页面</li>
</ul>
</li>
</ul>
<h3 id="渲染流程（上）：HTML、CSS-和-JavaScript-是如何变成页面的"><a href="#渲染流程（上）：HTML、CSS-和-JavaScript-是如何变成页面的" class="headerlink" title="渲染流程（上）：HTML、CSS 和 JavaScript 是如何变成页面的"></a>渲染流程（上）：HTML、CSS 和 JavaScript 是如何变成页面的</h3><ul>
<li>浏览器不能直接理解 HTML 数据，需要将其转化为 DOM 树结构；</li>
<li>生成 DOM 树后，根据 CSS 样式表，计算出 DOM 树所有节点样式；</li>
<li>创建布局树：遍历 DOM 树所有可见节点，把这些节点加到布局中，不可见节点忽略，如 head 标签下所有内容，display: none 元素；</li>
</ul>
<h3 id="渲染流程（下）：HTML、CSS-和-JavaScript-是如何变成页面的"><a href="#渲染流程（下）：HTML、CSS-和-JavaScript-是如何变成页面的" class="headerlink" title="渲染流程（下）：HTML、CSS 和 JavaScript 是如何变成页面的"></a>渲染流程（下）：HTML、CSS 和 JavaScript 是如何变成页面的</h3><ul>
<li>分层：层叠上下文属性的元素（比如定位属性元素、透明属性元素、CSS 滤镜属性元素）提升为单独的一层，需要裁剪的地方（比如出现滚动条）也会被创建为图层；</li>
<li>图层绘制：完成图层树构建后，渲染引擎会对图层树每一层进行绘制，把一个图层拆分成小的绘制指令，再把指令按照顺序组成一个带绘制列表；</li>
<li>有些情况图层很大，一次绘制所有图层内容，开销太大，合成线程会将图层划分为图块（256x256 或者 512x512）；</li>
<li>合成线程将图块提交给栅格线程进行栅格化，将图块转换为位图。栅格化过程都会使用 GPU 加速，生成的位图保存在 GPU 内存中；</li>
<li>一旦所有图块都被栅格化，合成线程会生成一个绘制图块命令（DrawQuad），然会将命令提交给浏览器进程，viz 组件接收到该指令，将页面内容绘制到内存中，显示在屏幕上；</li>
<li>重排：通过 JavaScript 或者 CSS 修改元素几何位置属性，会触发重新布局，解析后面一系列子阶段；重绘：不引起布局变换，直接进入绘制及其以后子阶段；合成：跳过布局和绘制阶段，执行的后续操作，发生在合成线程，非主线程；</li>
</ul>
<h3 id="变量提升：javascript-代码是按顺序执行的吗"><a href="#变量提升：javascript-代码是按顺序执行的吗" class="headerlink" title="变量提升：javascript 代码是按顺序执行的吗"></a>变量提升：javascript 代码是按顺序执行的吗</h3><ul>
<li>JavaScript 代码在执行之前需要先编译，在编译阶段，变量和函数会被存放到变量环境中，变量默认值会被设置为 undefined；</li>
<li>在代码执行阶段，JavaScript 引擎会从变量环境中查找自定义的变量和函数；</li>
<li>如果在编译阶段，窜爱两个相同的函数，那么最终放在变量环境中的是最后定义的那个，后定义的覆盖先定义的；</li>
</ul>
<h3 id="调用栈：为什么-JavaScript-代码会出现栈溢出"><a href="#调用栈：为什么-JavaScript-代码会出现栈溢出" class="headerlink" title="调用栈：为什么 JavaScript 代码会出现栈溢出"></a>调用栈：为什么 JavaScript 代码会出现栈溢出</h3><ul>
<li>每调用一个函数，JavaScript 引擎会为其创建执行上下文压入调用栈，然后，JavaScript 引擎开始执行函数代码。</li>
<li>如果一个函数 A 调用另外一个函数 B，那么 JavaScript 引擎会为 B 函数创建执行上下文，并将 B 函数的执行上下文压入栈顶。</li>
<li>当前函数执行完毕后，JavaScript 引擎会将该函数的执行上下文弹出栈。</li>
<li>当分配的调用栈空间被占满时，会引发“堆栈溢出”问题。</li>
</ul>
<h3 id="块级作用域：var-缺陷以及为什么要引入-let-和-const"><a href="#块级作用域：var-缺陷以及为什么要引入-let-和-const" class="headerlink" title="块级作用域：var 缺陷以及为什么要引入 let 和 const"></a>块级作用域：var 缺陷以及为什么要引入 let 和 const</h3><ul>
<li>let、const 申明的变量不会被提升。在 javascript 引擎编译后，会保存在词法环境中。</li>
<li>块级作用域在代码执行时，将 let、const 变量存放在词法环境的一个单独的区域。词法环境内部维护一个小型的栈结构，作用域内部变量压入栈顶。作用域执行完，从栈顶弹出。</li>
</ul>
<h3 id="作用域链和闭包：代码中出现相同的变量，JavaScript-引擎如何选择"><a href="#作用域链和闭包：代码中出现相同的变量，JavaScript-引擎如何选择" class="headerlink" title="作用域链和闭包：代码中出现相同的变量，JavaScript 引擎如何选择"></a>作用域链和闭包：代码中出现相同的变量，JavaScript 引擎如何选择</h3><ul>
<li>使用一个变量，JavaScript 引擎会在当前的执行上下文中查找变量，如果没有找到，会继续在 outer（执行环境指向外部执行上下文的引用）所指向的执行上下文中查找；</li>
<li>JavaScript 执行过程，作用域链是由词法作用域决定，而词法作用域是由代码中函数声明的位置决定；</li>
<li>根据词法作用域的规则，内部函数总是可以访问其外部函数中声明的变量，当通过调用一个外部函数返回一个内部函数后，即使外部函数已经执行结束了，但是内部函数引用外部函数的变量依旧保存在内存中，把这些变量的集合称为闭包；</li>
</ul>
<h3 id="this：从-JavaScript-执行上下文视角讲-this"><a href="#this：从-JavaScript-执行上下文视角讲-this" class="headerlink" title="this：从 JavaScript 执行上下文视角讲 this"></a>this：从 JavaScript 执行上下文视角讲 this</h3><p>当执行 new CreateObj 的时候，JavaScript 引擎做了四件事：</p>
<ul>
<li>首先创建一个控对象 tempObj；</li>
<li>接着调用 CreateObj.call 方法，并将 tempObj 作为 call 方法的参数，这样当 createObj 的执行上下文创建时，它的 this 就指向 tempObj 对象；</li>
<li>然后执行 CreateObj 函数，此时的 CreateObj 函数执行上下文中的 this 指向 tempObj 对象；</li>
<li>最后返回 tempObj 对象。</li>
</ul>
<p>this 的使用分为：</p>
<ul>
<li>当函数最为对象的方法调用时，函数中的 this 就是该对象；</li>
<li>当函数被正常调用时，在严格模式下，this 值是 undefined，非严格模式下 this 指向的是全局对象 window；</li>
<li>嵌套函数中的 this 不会继承外层函数的 this 值；</li>
<li>箭头函数没有自己的执行上下文，this 是外层函数的 this。</li>
</ul>
<h3 id="栈空间和堆空间：数据是如何存储的"><a href="#栈空间和堆空间：数据是如何存储的" class="headerlink" title="栈空间和堆空间：数据是如何存储的"></a>栈空间和堆空间：数据是如何存储的</h3><p>动态语言：在使用时需要检查数据类型的语言。<br>弱类型语言：支持隐式转换的语言。</p>
<p>JavaScript 中的 8 种数据类型，它们可以分为两大类——原始类型和引用类型。<br>原始类型数据存放在栈中，引用类型数据存放在堆中。堆中的数据是通过引用与变量关系联系起来的。</p>
<p>从内存视角了解闭包：词法扫描内部函数，引用了外部函数变量，堆空间创建一个“closure”对象，保存变量。</p>
<h3 id="垃圾回收：垃圾数据如何自动回收"><a href="#垃圾回收：垃圾数据如何自动回收" class="headerlink" title="垃圾回收：垃圾数据如何自动回收"></a>垃圾回收：垃圾数据如何自动回收</h3><ul>
<li>栈中数据回收：执行状态指针 ESP 在执行栈中移动，移过某执行上下文，就会被销毁；</li>
<li>堆中数据回收：V8 引擎采用标记-清除算法；</li>
<li>V8 把堆分为两个区域——新生代和老生代，分别使用副、主垃圾回收器；</li>
<li>副垃圾回收器负责新生代垃圾回收，小对象（1 ～ 8M）会被分配到该区域处理；</li>
<li>新生代采用 scavenge 算法处理：将新生代空间分为两半，一半空闲，一半存对象，对对象区域做标记，存活对象复制排列到空闲区域，没有内存碎片，完成后，清理对象区域，角色反转；</li>
<li>新生代区域两次垃圾回收还存活的对象晋升至老生代区域；</li>
<li>主垃圾回收器负责老生区垃圾回收，大对象，存活时间长；</li>
<li>老生代区域采用标记-清除算法回收垃圾：从根元素开始，递归，可到达的元素活动元素，否则是垃圾数据；</li>
<li>标记-清除算法后，会产生大量不连续的内存碎片，标记-整理算法让所有存活的对象向一端移动，然后清理掉边界以外的内存；</li>
<li>为降低老生代垃圾回收造成的卡顿，V8 将标记过程被切分为一个个子标记过程，让垃圾回收和 JavaScript 执行交替进行。</li>
</ul>
<h3 id="编译器和解析器：V8-如何执行一段-JavaScript-代码的"><a href="#编译器和解析器：V8-如何执行一段-JavaScript-代码的" class="headerlink" title="编译器和解析器：V8 如何执行一段 JavaScript 代码的"></a>编译器和解析器：V8 如何执行一段 JavaScript 代码的</h3><ul>
<li>计算机语言可以分为两种：编译型和解释型语言。编译型语言经过编译器编译后保留机器能读懂的二进制文件，比如 C/C++，go 语言。解释型语言是在程序运行时通过解释器对程序进行动态解释和执行，比如 Python，JavaScript 语言。</li>
<li>编译型语言的编译过程：编译器首先将代码进行词法分析、语法分析，生成抽象语法树（AST），然后优化代码，最后生成处理器能够理解的机器码；</li>
<li>解释型语言解释过程：解释器会对代码进行词法分析、语法分析，并生产抽象语法树（AST），不过它会再基于抽象语法树生成字节码，最后根据字节码执行程序；</li>
<li>AST 的生成：第一阶段是分词（词法分析），将一行行源码拆解成一个个 token（语法上不可再分、最小单个字符）。第二阶段是解析（语法分析），将上一步生成的 token 数据，根据语法规则转为 AST，这一阶段会检查语法错误；</li>
<li>字节码存在的意义：直接将 AST 转化为机器码，执行效率是非常高，但是消耗大量内存，从而先转化为字节码解决内存问题；</li>
<li>解释器 ignition 在解释执行字节码，同时会手机代码信息，发现某一部分代码是热点代码（HotSpot），编译器把热点的字节码转化为机器码，并保存起来，下次使用；</li>
<li>字节码配合解释器和编译器的实现称为即时编译（JIT）。</li>
</ul>
<h3 id="消息队列和事件循环：页面是怎么活起来的"><a href="#消息队列和事件循环：页面是怎么活起来的" class="headerlink" title="消息队列和事件循环：页面是怎么活起来的"></a>消息队列和事件循环：页面是怎么活起来的</h3><ul>
<li>每个渲染进程都有一个主线程，主线程会处理 DOM，计算样式，处理布局，JavaScript 任务以及各种输入事件；</li>
<li>维护一个消息队列，新任务（比如 IO 线程）添加到消息队列尾部，主线程循环地从消息队列头部读取任务，执行任务；</li>
<li>解决处理优先级高的任务：消息队列的中的任务称为宏任务，每个宏任务中都会包含一个微任务队列，在执行宏任务的过程中，如果 DOM 有变化，将该变化添加到微任务队列中；</li>
<li>解决单个任务执行时长过久：JavaScript 通过回调功能来规避。</li>
</ul>
<h3 id="webapi：setTimeout-是怎么实现的"><a href="#webapi：setTimeout-是怎么实现的" class="headerlink" title="webapi：setTimeout 是怎么实现的"></a>webapi：setTimeout 是怎么实现的</h3><ul>
<li>JavaScript 调用 setTimeout 设置回调函数的时候，渲染进程会创建一个回调任务，延时执行队列存放定时器任务；</li>
<li>当定时器任务到期，就会从延时队列中取出并执行；</li>
<li>如果当前任务执行时间过久，会影响延时到期定时器任务的执行；</li>
<li>如果 setTimeout 存在嵌套调用（5 次以上），判断该函数方法被阻塞，那么系统会设置最短时间间隔为 4 秒；</li>
<li>未激活的页面，setTimeout 执行最小间隔是 1000 毫秒，目的是为了降低加载损耗；</li>
<li>延时执行时间最大值是 24.8 天，因为延时值是以 32 个 bit 存储的；</li>
<li>setTimeout 设置的回调函数中的 this 指向全局 window。</li>
</ul>
<h3 id="webpai：XMLHttpRequest-是怎么实现的"><a href="#webpai：XMLHttpRequest-是怎么实现的" class="headerlink" title="webpai：XMLHttpRequest 是怎么实现的"></a>webpai：XMLHttpRequest 是怎么实现的</h3><ul>
<li>XMLHttpRequest onreadystatechange 处理流程：未初始化 -&gt; OPENED -&gt; HEADERS_RECEIVED -&gt; LOADING -&gt; DONE；</li>
<li>渲染进程会将请求发送给网络进程，然后网络进程负责资源下载，等网络进程接收到数据后，利用 IPC 通知渲染进程；</li>
<li>渲染进程接收到消息之后，会将 xhr 回调函数封装成任务并添加到消息队列中，等主线程循环系统执行到该任务的时候，会根据相关状态来调用回调函数。</li>
</ul>
<h3 id="宏任务和微任务：不是所有的任务都是一个待遇"><a href="#宏任务和微任务：不是所有的任务都是一个待遇" class="headerlink" title="宏任务和微任务：不是所有的任务都是一个待遇"></a>宏任务和微任务：不是所有的任务都是一个待遇</h3><ul>
<li>消息队列中的任务为宏任务。渲染进程内部会维护多个消息队列，比如延时执行队列和普通消息队列，主线程采用 for 循环，不断地从这些任务队列中取出任务并执行；</li>
<li>微任务是一个需要异步执行的函数，执行时机是在主函数执行结束之后、当前宏任务结束之前；</li>
<li>V8 在执行 javascript 脚本时，会为其创建一个全局执行上下文，同时会创建一个微任务队列；</li>
<li>执行微任务过程中产生的微任务不会推迟到下个宏任务中执行，而是在当前宏任务中继续执行；</li>
</ul>
<h3 id="使用-Promise-告别回调函数"><a href="#使用-Promise-告别回调函数" class="headerlink" title="使用 Promise 告别回调函数"></a>使用 Promise 告别回调函数</h3><ul>
<li>使用 Promise 解决了回调地狱问题，消灭嵌套和多次处理；</li>
<li>模拟实现 Promise</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Bromise</span>(<span class="params">executor</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> _onResolve = <span class="literal">null</span></span><br><span class="line">  <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onResolve</span>) </span>&#123;</span><br><span class="line">    _onResolve = onResolve</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">value</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      _onResolve(value)</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  executor(resolve, <span class="literal">null</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="async-await-使用同步方式写异步代码"><a href="#async-await-使用同步方式写异步代码" class="headerlink" title="async await 使用同步方式写异步代码"></a>async await 使用同步方式写异步代码</h3><ul>
<li>生成器函数是一个带星号函数，而且是可以暂停执行和回复执行的；</li>
<li>生成器函数内部执行一段代码，遇到 yield 关键字，javascript 引擎返回关键字后面的内容给外部，并且暂停该函数的执行；</li>
<li>外部函数可以同步 next 方法恢复函数的执行；</li>
<li>协程是一种比线程更加轻量级的存在，协程可以看成是跑在线程上的任务，一个线程可以存在多个协程，但是同时只能执行一个协程，如果 A 协程启动 B 协程，A 为 B 的父协程；</li>
<li>协程不被操作协同内核所管理，而完全由程序所控制，这样性能提升；</li>
<li><code>await xxx</code> 会创建一个 Promise 对象，将 <code>xxx</code> 任务提交给微任务队列；</li>
<li>暂停当前协程的执行，将主线程的控制权力转交给父协程执行，同时将 Promise 对象返回给父协程，继续执行父协程；</li>
<li>父协程执行结束之前会检查微任务队列，微任务队列中有 <code>resolve(xxx)</code> 等待执行，触发 then 的回调函数；</li>
<li>回调函数被激活后，会将主线程的控制权交给协程，继续执行后续语句，完成后将控制权还给父协程。</li>
</ul>
<h3 id="页面性能分析：利用-chrome-做-web-性能分析"><a href="#页面性能分析：利用-chrome-做-web-性能分析" class="headerlink" title="页面性能分析：利用 chrome 做 web 性能分析"></a>页面性能分析：利用 chrome 做 web 性能分析</h3><ul>
<li>Chrome 开发者工具（简称 DevTools）是一组网页制作和调试的工具，内嵌于 Google Chrome 浏览器中。它一共包含了 10 个功能面板，包括了 Elements、Console、Sources、NetWork、Performance、Memory、Application、Security、Audits 和 Layers。</li>
</ul>
<h3 id="DOM-树：JavaScript-是如何影响-DOM-树构建的"><a href="#DOM-树：JavaScript-是如何影响-DOM-树构建的" class="headerlink" title="DOM 树：JavaScript 是如何影响 DOM 树构建的"></a>DOM 树：JavaScript 是如何影响 DOM 树构建的</h3><ul>
<li>HTML 解析器（HTMLParse）负责将 HTML 字节流转换为 DOM 结构；</li>
<li>HTML 解析器并不是等整个文档加载完成之后再解析，而是网络进程加载流多少数据，便解析多少数据；</li>
<li>字节流转换成 DOM 三个阶段：1、字节流转换为 Token；2、维护一个 Token 栈，遇到 StartTag Token 入栈，遇到 EndTag Token 出栈；3、为每个 Token 创建一个 DOM 节点；</li>
<li>JavaScript 文件和 CSS 样式表文件都会阻塞 DOM 解析；</li>
</ul>
<h3 id="渲染流水线：CSS-如何影响首次加载时的白屏时间？"><a href="#渲染流水线：CSS-如何影响首次加载时的白屏时间？" class="headerlink" title="渲染流水线：CSS 如何影响首次加载时的白屏时间？"></a>渲染流水线：CSS 如何影响首次加载时的白屏时间？</h3><ul>
<li>DOM 构建结束之后，css 文件还未下载完成，渲染流水线空闲，因为下一步是合成布局树，合成布局树需要 CSSOM 和 DOM，这里需要等待 CSS 加载结束并解析成 CSSOM；</li>
<li>CSSOM 两个作用：提供给 JavaScript 操作样式表能力，为布局树的合成提供基础样式信息；</li>
<li>在执行 JavaScript 脚本之前，如果页面中包含了外部 CSS 文件的引用，或者通过 style 标签内置了 CSS 内容，那么渲染引擎还需要将这些内容转化为 CSSOM，因为 JavaScript 有修改 CSSOM 的能力，所以在执行 JavaScript 之前，还需要依赖 CSSOM。也就是说 CSS 在部分情况下也会阻塞 DOM 的生成。</li>
</ul>
<h3 id="分层和合成机制：为什么-CSS-动画比-JavaScript-高效"><a href="#分层和合成机制：为什么-CSS-动画比-JavaScript-高效" class="headerlink" title="分层和合成机制：为什么 CSS 动画比 JavaScript 高效"></a>分层和合成机制：为什么 CSS 动画比 JavaScript 高效</h3><ul>
<li>显示器固定刷新频率是 60HZ，即每秒更新 60 张图片，图片来自显卡的前缓冲区；</li>
<li>显卡的职责是合成新的图像，保存在后缓冲区，然后后缓冲区和前缓冲区互换，显卡更新频率和显示前刷新频率不一致，就会造成视觉上的卡顿；</li>
<li>渲染流水线生成的每一副图片称为一帧，生成一帧的方式有重排、重绘和合成三种；</li>
<li>重排会根据 CSSOM 和 DOM 计算布局树，重绘没有重新布局阶段；</li>
<li>生成布局树之后，渲染引擎根据布局树特点转化为层树，每一层解析出绘制列表；</li>
<li>栅格线程根据绘制列表中的指令生成图片，每一层对应一张图片，合成线程将这些图片合成一张图片，发送到后缓存区；</li>
<li>合成线程会将每个图层分割成大小固定的图块，优先绘制靠近视口的图块；</li>
</ul>
<h3 id="页面性能：如何系统优化页面"><a href="#页面性能：如何系统优化页面" class="headerlink" title="页面性能：如何系统优化页面"></a>页面性能：如何系统优化页面</h3><ul>
<li>加载阶段：减少关键资源个数，降低关键资源大小，降低关键资源的 RTT 次数；</li>
<li>交互阶段：减少 JavaScript 脚本执行时间，避免强制同步布局：操作 DOM 的同时获取布局样式会引发，避免布局抖动：多次执行强制布局和抖动，合理利用 CSS 合成动画：标记 will-change，避免频繁的垃圾回收；</li>
<li>CSS 实现一些变形、渐变、动画等特效，这是由 CSS 触发的，并且是在合成线程中执行，这个过程称为合成，它不会触发重排或者重绘；</li>
</ul>
<h3 id="虚拟-DOM：虚拟-DOM-和真实-DOM-有何不同"><a href="#虚拟-DOM：虚拟-DOM-和真实-DOM-有何不同" class="headerlink" title="虚拟 DOM：虚拟 DOM 和真实 DOM 有何不同"></a>虚拟 DOM：虚拟 DOM 和真实 DOM 有何不同</h3><ul>
<li>当有数据更新时， React 会生产一个新的虚拟 DOM，然会拿新的虚拟 DOM 和之前的虚拟 DOM 进行比较，这个过程找出变化的节点，然后将变化的节点应用到 DOM 上；</li>
<li>最开始的时候，比较两个 DOM 的过程是在一个递归函数里执行的，其核心算法是 reconciliation。通常情况，这个比较过程执行很快，不过虚拟 DOM 比较复杂时，执行比较函数可能占据主线程比较久的时间，这样会导致其他任务的等待，造成页面卡顿。React 团队重写了 reconciliation 算法，称为 Fiber reconciler，之前老的算法称为 Stack reconciler；</li>
</ul>
<h3 id="PWA：解决-web-应用哪些问题"><a href="#PWA：解决-web-应用哪些问题" class="headerlink" title="PWA：解决 web 应用哪些问题"></a>PWA：解决 web 应用哪些问题</h3><ul>
<li>PWA（Progressive Web App），渐进式 Web 应用。一个渐进式过渡方案，让普通站点过渡到 Web 应用，降低站点改造代价，逐渐支持新技术，而不是一步到位；</li>
<li>PWA 引入 ServiceWorker 来试着解决离线存储和消息推送问题，引入 mainfest.json 来解决一级入口问题；</li>
<li>暗转了 ServiceWorker 模块之后，WebApp 请求资源时，会先通过 ServiceWorker，让它判断是返回 Serviceworker 缓存的资源还是重新去网络请求资源，一切的控制权交给 ServiceWorker 来处理；</li>
<li>在目前的 Chrome 架构中，Service Worker 是运行在浏览器进程中的，因为浏览器进程生命周期是最长的，所以在浏览器的生命周期内，能够为所有的页面提供服务；</li>
</ul>
<h3 id="WebComponent：像搭积木一样构建-web-应用"><a href="#WebComponent：像搭积木一样构建-web-应用" class="headerlink" title="WebComponent：像搭积木一样构建 web 应用"></a>WebComponent：像搭积木一样构建 web 应用</h3><ul>
<li>CSS 的全局属性会阻碍组件化，DOM 也是阻碍组件化的一个因素，因为页面中只有一个 DOM，任何地方都可以直接读取和修改 DOM；</li>
<li>WebComponent 提供了对局部试图封装能力，可以让 DOM、CSSOM 和 JavaScript 运行在局部环境中；</li>
<li>template 创建模版，查找模版内容，创建影子 DOM，模版添加到影子 DOM 上；</li>
<li>影子 DOM 可以隔离全局 CSS 和 DOM，但是 JavaScript 是不会被隔离的；</li>
</ul>
<h3 id="HTTP1：HTTP1-性能优化"><a href="#HTTP1：HTTP1-性能优化" class="headerlink" title="HTTP1：HTTP1 性能优化"></a>HTTP1：HTTP1 性能优化</h3><ul>
<li>HTTP/0.9 基于 TCP 协议，三次握手建立连接，发送一个 GET 请求行（没有请求头和请求体），服务器接收请求之后，读取对应 HTML 文件，数据以 ASCII 字符流返回，传输完成断开连接；</li>
<li>HTTP/1.0 增加请求头和响应头来进行协商，在发起请求时通过请求头告诉服务器它期待返回什么类型问题、什么形式压缩、什么语言以及文件编码。引入来状态吗，Cache 机制等；</li>
<li>HTTP/1.1 改进持久化连接，解决建立 TCP 连接、传输数据和断开连接带来的大量开销，支持在一个 TCP 连接上可以传输多个 HTTP 请求，目前浏览器对于一个域名同时允许建立 6 个 TCP 持久连接；</li>
<li>HTTP/1.1 引入 Chunk transfer 支持动态生成内容：服务器将数据分割成若干任意大小的数据块，每个数据块发送时附上上个数据块的长度，最后使用一个零长度的块作为发送数据完成的标志。在 HTTP/1.1 需要在响应头中设置完整的数据大小，如 Content-Length。</li>
</ul>
<h3 id="HTTP2：如何提升网络速度"><a href="#HTTP2：如何提升网络速度" class="headerlink" title="HTTP2：如何提升网络速度"></a>HTTP2：如何提升网络速度</h3><ul>
<li>HTTP/1.1 主要问题：TCP 慢启动；同时开启多条 TCP 连接，会竞争固定宽带；对头阻塞问题；</li>
<li>HTTP/2 在一个域名下只使用一个 TCP 长连接和消除对头阻塞问题；</li>
<li>多路复用的实现：HTTP/2 添加了二进制分帧层，将发送或响应数据经过二进制分帧处理，转化为一个个带有请求 ID 编号的帧，服务器或者浏览器接收到响应帧后，根据相同 ID 帧合并为一条完整信息；</li>
<li>设置请求优先级：发送请求可以设置请求优先级，服务器可以优先处理；</li>
<li>服务器推送：请求一个 HTML 页面，服务器可以知道引用了哪些 JavaScript 和 CSS 文件，附带一起发送给浏览器；</li>
<li>头部压缩：对请求头和响应头进行压缩；</li>
</ul>
<h3 id="HTTP3：甩掉-TCP、TCL-包袱，构建高效网络"><a href="#HTTP3：甩掉-TCP、TCL-包袱，构建高效网络" class="headerlink" title="HTTP3：甩掉 TCP、TCL 包袱，构建高效网络"></a>HTTP3：甩掉 TCP、TCL 包袱，构建高效网络</h3><ul>
<li>虽然 HTTP/2 解决了应用层面的对头阻塞问题，不过和 HTTP/1.1 一样，HTTP/2 依然是基于 TCP 协议，而 TCP 最初是为了单连接而设计；</li>
<li>TCP 可以看成是计算机之间的一个虚拟管道，数据从一端发送到另一端会被拆分为一个个按照顺序排列的数据包，如果在传输过程中，有一个数据因为网络故障或者其他原因丢失，那么整个连接会处于暂停状态，只有等到该数据重新传输；</li>
<li>由于 TCP 协议僵化，也不可能使用新的协议，HTTP/3 选择了一个折衷的方法，基于现有的 UDP 协议，实现类似 TC 片多路复用，传输可靠等功能，称为 QULC 协议；</li>
<li>QULC 实现类似 TCP 流量控制，传输可靠功能；集成 TLS 加密功能；实现多路复用功能；</li>
</ul>
<h3 id="同源策略：为什么-XMLHttpRequst-不能跨域请求"><a href="#同源策略：为什么-XMLHttpRequst-不能跨域请求" class="headerlink" title="同源策略：为什么 XMLHttpRequst 不能跨域请求"></a>同源策略：为什么 XMLHttpRequst 不能跨域请求</h3><ul>
<li>协议、域名和端口号相同的 URL 是同源的；</li>
<li>同源策略会隔离不同源的 DOM、页面数据和网络通信；</li>
<li>页面可以引用第三方资源，不过暴露出诸如 XSS 问题，引入内容安全策略 CSP 限制；</li>
<li>默认 XMLHttpRequest 和 Fetch 不能跨站请求资源，引入跨域资源共享（CORS）进行跨域访问控制；</li>
</ul>
<h3 id="跨站脚本攻击-XSS：为什么-cookie-中有-httpOnly-属性"><a href="#跨站脚本攻击-XSS：为什么-cookie-中有-httpOnly-属性" class="headerlink" title="跨站脚本攻击 XSS：为什么 cookie 中有 httpOnly 属性"></a>跨站脚本攻击 XSS：为什么 cookie 中有 httpOnly 属性</h3><ul>
<li>XSS 跨站脚本，往 HTML 文件中注入恶意代码，对用户实施攻击；</li>
<li>XSS 攻击主要有存储型 XSS 攻击、反射型 XSS 攻击和 DOM 的 XSS 攻击；</li>
<li>阻止 XSS 攻击：服务器对脚本进行过滤或转码，利用 CSP 策略，使用 HttpOnly；</li>
</ul>
<h3 id="CSRF-攻击：陌生连接不要随便点"><a href="#CSRF-攻击：陌生连接不要随便点" class="headerlink" title="CSRF 攻击：陌生连接不要随便点"></a>CSRF 攻击：陌生连接不要随便点</h3><ul>
<li>CSRF 跨站请求伪造，利用用户的登录状态，通过第三方站点攻击；</li>
<li>避免 CSRF 攻击：利用 SameSite（三种模式：Strict、Lax、None） 让浏览器禁止第三方站点发起请求携带关键 Cookie；验证请求的来源站点，请求头中的 Referer 和 Origin 属性；利用 CSRF Token；</li>
</ul>
<h3 id="沙盒：页面和系统之间的隔离墙"><a href="#沙盒：页面和系统之间的隔离墙" class="headerlink" title="沙盒：页面和系统之间的隔离墙"></a>沙盒：页面和系统之间的隔离墙</h3><ul>
<li>浏览器被划分为浏览器内核和渲染内核两个核心模块，其中浏览器内核是由网络进程、浏览器主进程和 GPU 进程组成的，渲染内核就是渲染进程；</li>
<li>浏览器中的安全沙箱是利用操作系统提供的安全技术，让渲染进程在执行过程中无法访问或者修改操作系统中的数据，在渲染进程需要访问系统资源的时候，需要通过浏览器内核来实现，然后将访问的结果通过 IPC 转发给渲染进程；</li>
<li>站点隔离（Site Isolation）将同一站点（包含相同根域名和相同协议的地址）中相互关联的页面放到同一个渲染进程中执行；</li>
<li>实现站点隔离，就可以将恶意的 iframe 隔离在恶意进程内部，使得它无法继续访问其他 iframe 进程的内容，因此无法攻击其他站点；</li>
</ul>
<h3 id="HTTPS：让数据传输更安全"><a href="#HTTPS：让数据传输更安全" class="headerlink" title="HTTPS：让数据传输更安全"></a>HTTPS：让数据传输更安全</h3><ul>
<li>在 TCP 和 HTTP 之间插入一个安全层，所有经过安全层的数据都会被加密或者解密；</li>
<li>对称加密：浏览器发送加密套件列表和一个随机数 client-random，服务器会从加密套件中选取一个加密套件，然后生成一个随机数 service-random，返回给浏览器。这样浏览器和服务器都有相同 client-random 和 service-random，再用相同的方法将两者混合生成一个密钥 master secret，双方就可以进行数据加密传输了；</li>
<li>对称加密缺点：client-random 和 service-random 的过程都是明文，黑客可以拿到协商的加密套件和双方随机数，生成密钥，数据可以被破解；</li>
<li>非对称加密：浏览器发送加密套件列表给服务器，服务器选择一个加密套件，返回加密套件和公钥，浏览器用公钥加密数据，服务器用私钥解密；</li>
<li>非对称加密缺点：加密效率太低，不能保证服务器发送给浏览器的数据安全，黑客可以获取公钥；</li>
<li>对称加密结合非对称加密：浏览器发送对称加密套件列表、非对称加密列表和随机数 client-random 给服务器，服务器生成随机数 service-random，选择加密套件和公钥返回给浏览器，浏览器利用 client-random 和 service-random 计算出 pre-master，然后利用公钥给 pre-master 加密，向服务器发送加密后的数据，服务器用私钥解密出 pre-master 数据，结合 client-random 和 service-random 生成对称密钥，使用对称密钥传输加密数据；</li>
<li>引入数字证书是为了证明“我就是我”，防止 DNS 被劫持，伪造服务器；</li>
<li>证书的作用：一个是向浏览器证明服务器的身份，另一个是包含服务器公钥；</li>
<li>数字签名过程：CA 使用 Hash 函数技术明文信息，得出信息摘要，然后 CA 使用私钥对信息摘要进行加密，加密后的秘文就是数字签名；</li>
<li>验证数字签名：读取证书明文信息，使用相同 Hash 函数计算得到信息摘要 A，再利用 CA 的公钥解密得到 B，对比 A 和 B，如果一致，则确认证书合法；</li>
</ul>
<h2 id="原文整理"><a href="#原文整理" class="headerlink" title="原文整理"></a>原文整理</h2><p>最后，在网上有些大神有整理出了各个章节在线原文，确实是花了不少心思，在这里也整理到 git 上了，有兴趣的童鞋可以自行查阅，完～</p>
<h3 id="宏观视角上的浏览器"><a href="#宏观视角上的浏览器" class="headerlink" title="宏观视角上的浏览器"></a>宏观视角上的浏览器</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.1.Chrome%E6%9E%B6%E6%9E%84%EF%BC%9A%E4%BB%85%E4%BB%85%E6%89%93%E5%BC%801%E4%B8%AA%E9%A1%B5%E9%9D%A2%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%9C%894%E4%B8%AA%E8%BF%9B%E7%A8%8B/index.md" target="_blank" rel="noopener">Chrome 架构：仅仅打开 1 个页面，为什么有 4 个进程</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.2.TCP%E5%8D%8F%E8%AE%AE%EF%BC%9A%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E9%A1%B5%E9%9D%A2%E6%96%87%E4%BB%B6%E8%83%BD%E8%A2%AB%E5%AE%8C%E6%95%B4%E9%80%81%E8%BE%BE%E6%B5%8F%E8%A7%88%E5%99%A8/index.md" target="_blank" rel="noopener">TCP 协议：如何保证页面文件能被完整送达浏览器</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.3.HTTP%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E5%BE%88%E5%A4%9A%E7%AB%99%E7%82%B9%E7%AC%AC%E4%BA%8C%E6%AC%A1%E6%89%93%E5%BC%80%E9%80%9F%E5%BA%A6%E4%BC%9A%E5%BE%88%E5%BF%AB/index.md" target="_blank" rel="noopener">HTTP 请求流程：为什么很多站点第二次打开速度会很快</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.4.%E5%AF%BC%E8%88%AA%E6%B5%81%E7%A8%8B%EF%BC%9A%E4%BB%8E%E8%BE%93%E5%85%A5URL%E5%88%B0%E9%A1%B5%E9%9D%A2%E5%B1%95%E7%A4%BA%E8%BF%99%E4%B8%AD%E9%97%B4%E5%8F%91%E7%94%9F%E4%BA%86%E4%BB%80%E4%B9%88/index.md" target="_blank" rel="noopener">导航流程：从输入 URL 到页面展示这中间发生了什么</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.5.%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%EF%BC%88%E4%B8%8A%EF%BC%89%EF%BC%9AHTML%E3%80%81CSS%E5%92%8CJavaScript%E6%98%AF%E5%A6%82%E4%BD%95%E5%8F%98%E6%88%90%E9%A1%B5%E9%9D%A2%E7%9A%84/index.md" target="_blank" rel="noopener">渲染流程（上）：HTML、CSS 和 JavaScript 是如何变成页面的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/1.%E5%AE%8F%E8%A7%82%E8%A7%86%E8%A7%92%E4%B8%8A%E7%9A%84%E6%B5%8F%E8%A7%88%E5%99%A8/1.6.%E6%B8%B2%E6%9F%93%E6%B5%81%E7%A8%8B%EF%BC%88%E4%B8%8B%EF%BC%89%EF%BC%9AHTML%E3%80%81CSS%E5%92%8CJavaScript%E6%98%AF%E5%A6%82%E4%BD%95%E5%8F%98%E6%88%90%E9%A1%B5%E9%9D%A2%E7%9A%84/index.md" target="_blank" rel="noopener">渲染流程（下）：HTML、CSS 和 JavaScript 是如何变成页面的</a></li>
</ul>
<h3 id="浏览器中的-JavaScript-执行机制"><a href="#浏览器中的-JavaScript-执行机制" class="headerlink" title="浏览器中的 JavaScript 执行机制"></a>浏览器中的 JavaScript 执行机制</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/2.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/2.1.%E5%8F%98%E9%87%8F%E6%8F%90%E5%8D%87%EF%BC%9AJavaScript%E4%BB%A3%E7%A0%81%E6%98%AF%E6%8C%89%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%E7%9A%84%E5%90%97/index.md" target="_blank" rel="noopener">变量提升：JavaScript 代码是按顺序执行的吗</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/2.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/2.2.%E8%B0%83%E7%94%A8%E6%A0%88%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88JavaScript%E4%BB%A3%E7%A0%81%E4%BC%9A%E5%87%BA%E7%8E%B0%E6%A0%88%E6%BA%A2%E5%87%BA/index.md" target="_blank" rel="noopener">调用栈：为什么 JavaScript 代码会出现栈溢出</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/2.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/2.3.%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F%EF%BC%9Avar%E7%BC%BA%E9%99%B7%E4%BB%A5%E5%8F%8A%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E5%BC%95%E5%85%A5let%E5%92%8Cconst/index.md" target="_blank" rel="noopener">块级作用域：var 缺陷以及为什么要引入 let 和 const</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/2.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/2.4.%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85%EF%BC%9A%E4%BB%A3%E7%A0%81%E4%B8%AD%E5%87%BA%E7%8E%B0%E7%9B%B8%E5%90%8C%E7%9A%84%E5%8F%98%E9%87%8F%EF%BC%8CJavaScript%E5%BC%95%E6%93%8E%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9/index.md" target="_blank" rel="noopener">作用域链和闭包：代码中出现相同的变量，JavaScript 引擎如何选择</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/2.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84JavaScript%E6%89%A7%E8%A1%8C%E6%9C%BA%E5%88%B6/2.5.this%EF%BC%9A%E4%BB%8EJavaScript%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E8%A7%86%E8%A7%92%E8%AE%B2this/index.md" target="_blank" rel="noopener">this：从 JavaScript 执行上下文视角讲 this</a></li>
</ul>
<h3 id="V8-工作原理"><a href="#V8-工作原理" class="headerlink" title="V8 工作原理"></a>V8 工作原理</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/3.V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/3.1.%E6%A0%88%E7%A9%BA%E9%97%B4%E5%92%8C%E5%A0%86%E7%A9%BA%E9%97%B4%EF%BC%9A%E6%95%B0%E6%8D%AE%E6%98%AF%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E7%9A%84/index.md" target="_blank" rel="noopener">栈空间和堆空间：数据是如何存储的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/3.V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/3.2.%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%EF%BC%9A%E5%9E%83%E5%9C%BE%E6%95%B0%E6%8D%AE%E5%A6%82%E4%BD%95%E8%87%AA%E5%8A%A8%E5%9B%9E%E6%94%B6/index.md" target="_blank" rel="noopener">垃圾回收：垃圾数据如何自动回收</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/3.V8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/3.3.%E7%BC%96%E8%AF%91%E5%99%A8%E5%92%8C%E8%A7%A3%E6%9E%90%E5%99%A8%EF%BC%9AV8%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E4%B8%80%E6%AE%B5JavaScript%E4%BB%A3%E7%A0%81%E7%9A%84/index.md" target="_blank" rel="noopener">编译器和解析器：V8 如何执行一段 JavaScript 代码的</a></li>
</ul>
<h3 id="浏览器中的页面循环系统"><a href="#浏览器中的页面循环系统" class="headerlink" title="浏览器中的页面循环系统"></a>浏览器中的页面循环系统</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.1.%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E5%92%8C%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%9A%E9%A1%B5%E9%9D%A2%E6%98%AF%E6%80%8E%E4%B9%88%E6%B4%BB%E8%B5%B7%E6%9D%A5%E7%9A%84/index.md" target="_blank" rel="noopener">消息队列和事件循环：页面是怎么活起来的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.2.Webapi%EF%BC%9AsetTimeout%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/index.md" target="_blank" rel="noopener">Webapi：setTimeout 是怎么实现的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.3.Webapi%EF%BC%9AXMLHttpRequest%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9E%E7%8E%B0%E7%9A%84/index.md" target="_blank" rel="noopener">Webapi：XMLHttpRequest 是怎么实现的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.4.%E5%AE%8F%E4%BB%BB%E5%8A%A1%E5%92%8C%E5%BE%AE%E4%BB%BB%E5%8A%A1%EF%BC%9A%E4%B8%8D%E6%98%AF%E6%89%80%E6%9C%89%E7%9A%84%E4%BB%BB%E5%8A%A1%E9%83%BD%E6%98%AF%E4%B8%80%E4%B8%AA%E5%BE%85%E9%81%87/index.md" target="_blank" rel="noopener">宏任务和微任务：不是所有的任务都是一个待遇</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.5.%E4%BD%BF%E7%94%A8Promise%E5%91%8A%E5%88%AB%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0/index.md" target="_blank" rel="noopener">使用 Promise 告别回调函数</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/4.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2%E5%BE%AA%E7%8E%AF%E7%B3%BB%E7%BB%9F/4.6.async-await%E4%BD%BF%E7%94%A8%E5%90%8C%E6%AD%A5%E6%96%B9%E5%BC%8F%E5%86%99%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81/index.md" target="_blank" rel="noopener">async-await 使用同步方式写异步代码</a></li>
</ul>
<h3 id="浏览器中的页面"><a href="#浏览器中的页面" class="headerlink" title="浏览器中的页面"></a>浏览器中的页面</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.1.%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90%EF%BC%9A%E5%88%A9%E7%94%A8chrome%E5%81%9Aweb%E6%80%A7%E8%83%BD%E5%88%86%E6%9E%90/index.md" target="_blank" rel="noopener">页面性能分析：利用 chrome 做 web 性能分析</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.2.DOM%E6%A0%91%EF%BC%9AJavaScript%E6%98%AF%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8DDOM%E6%A0%91%E6%9E%84%E5%BB%BA%E7%9A%84/index.md" target="_blank" rel="noopener">DOM 树：JavaScript 是如何影响 DOM 树构建的</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.3.%E6%B8%B2%E6%9F%93%E6%B5%81%E6%B0%B4%E7%BA%BF%EF%BC%9ACSS%E5%A6%82%E4%BD%95%E5%BD%B1%E5%93%8D%E9%A6%96%E6%AC%A1%E5%8A%A0%E8%BD%BD%E6%97%B6%E7%9A%84%E7%99%BD%E5%B1%8F%E6%97%B6%E9%97%B4/index.md" target="_blank" rel="noopener">渲染流水线：CSS 如何影响首次加载时的白屏时间</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.4.%E5%88%86%E5%B1%82%E5%92%8C%E5%90%88%E6%88%90%E6%9C%BA%E5%88%B6%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88CSS%E5%8A%A8%E7%94%BB%E6%AF%94JavaScript%E9%AB%98%E6%95%88/index.md" target="_blank" rel="noopener">分层和合成机制：为什么 CSS 动画比 JavaScript 高效</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.5.%E9%A1%B5%E9%9D%A2%E6%80%A7%E8%83%BD%EF%BC%9A%E5%A6%82%E4%BD%95%E7%B3%BB%E7%BB%9F%E4%BC%98%E5%8C%96%E9%A1%B5%E9%9D%A2/index.md" target="_blank" rel="noopener">页面性能：如何系统优化页面</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.6.%E8%99%9A%E6%8B%9FDOM%EF%BC%9A%E8%99%9A%E6%8B%9FDOM%E5%92%8C%E5%AE%9E%E9%99%85DOM%E6%9C%89%E4%BD%95%E4%B8%8D%E5%90%8C/index.md" target="_blank" rel="noopener">虚拟 DOM：虚拟 DOM 和实际 DOM 有何不同</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.7.PWA%EF%BC%9A%E8%A7%A3%E5%86%B3%E4%BA%86web%E5%BA%94%E7%94%A8%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98/index.md" target="_blank" rel="noopener">PWA：解决了 web 应用哪些问题</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/5.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E9%A1%B5%E9%9D%A2/5.8.webComponent%EF%BC%9A%E5%83%8F%E6%90%AD%E7%A7%AF%E6%9C%A8%E4%B8%80%E6%A0%B7%E6%9E%84%E5%BB%BAweb%E5%BA%94%E7%94%A8/index.md" target="_blank" rel="noopener">webComponent：像搭积木一样构建 web 应用</a></li>
</ul>
<h3 id="浏览器中的网络"><a href="#浏览器中的网络" class="headerlink" title="浏览器中的网络"></a>浏览器中的网络</h3><ul>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.1.HTTP1%EF%BC%9AHTTP%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/index.md" target="_blank" rel="noopener">HTTP1：HTTP 性能优化</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.2.HTTP2%EF%BC%9A%E5%A6%82%E4%BD%95%E6%8F%90%E5%8D%87%E7%BD%91%E7%BB%9C%E9%80%9F%E5%BA%A6/index.md" target="_blank" rel="noopener">HTTP2：如何提升网络速度</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.3.HTTP3%EF%BC%9A%E7%94%A9%E6%8E%89TCP%E3%80%81TCL%E5%8C%85%E8%A2%B1%EF%BC%8C%E6%9E%84%E5%BB%BA%E9%AB%98%E6%95%88%E7%BD%91%E7%BB%9C/index.md" target="_blank" rel="noopener">HTTP3：甩掉 TCP、TCL 包袱，构建高效网络</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.4.%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88XMLHttpRequest%E4%B8%8D%E8%83%BD%E8%B7%A8%E5%9F%9F%E8%AF%B7%E6%B1%82%E8%B5%84%E6%BA%90/index.md" target="_blank" rel="noopener">同源策略：为什么 XMLHttpRequest 不能跨域请求资源</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.5.%E8%B7%A8%E7%AB%99%E8%84%9A%E6%9C%AC%E6%94%BB%E5%87%BBXSS%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88cookie%E4%B8%AD%E6%9C%89httpOnly%E5%B1%9E%E6%80%A7/index.md" target="_blank" rel="noopener">跨站脚本攻击 XSS：为什么 cookie 中有 httpOnly 属性</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.6.CSRF%E6%94%BB%E5%87%BB%EF%BC%9A%E9%99%8C%E7%94%9F%E9%93%BE%E6%8E%A5%E4%B8%8D%E8%A6%81%E9%9A%8F%E4%BE%BF%E7%82%B9/index.md" target="_blank" rel="noopener">CSRF 攻击：陌生链接不要随便点</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.7.%E6%B2%99%E7%9B%92%EF%BC%9A%E9%A1%B5%E9%9D%A2%E5%92%8C%E7%B3%BB%E7%BB%9F%E4%B9%8B%E9%97%B4%E7%9A%84%E9%9A%94%E7%A6%BB%E5%A2%99/index.md" target="_blank" rel="noopener">沙盒：页面和系统之间的隔离墙</a></li>
<li><a href="https://github.com/wuwhs/browser-working-principle-note/blob/main/6.%E6%B5%8F%E8%A7%88%E5%99%A8%E4%B8%AD%E7%9A%84%E7%BD%91%E7%BB%9C/6.8.HTTPS%EF%BC%9A%E8%AE%A9%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E6%9B%B4%E5%AE%89%E5%85%A8/index.md" target="_blank" rel="noopener">HTTPS：让数据传输更安全</a></li>
</ul>
<blockquote>
<p><a href="https://blog.poetries.top/browser-working-principle/" target="_blank" rel="noopener">浏览器工作原理与实践</a></p>
</blockquote>

      
    </div>

    
      


    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>wuwhs</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://wuwhs.gitee.io/2021/05/31/browser-working-principle/" title="浏览器工作原理与实践">https://wuwhs.gitee.io/2021/05/31/browser-working-principle/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/浏览器/" rel="tag"># 浏览器</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2021/04/05/fe-optimization-http/" rel="next" title="基于http前端性能优化">
                <i class="fa fa-chevron-left"></i> 基于http前端性能优化
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2021/09/05/inter-principle/" rel="prev" title="inter-principle">
                inter-principle <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="wuwhs" />
            
              <p class="site-author-name" itemprop="name">wuwhs</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">70</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/wuwhs" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://segmentfault.com/u/wuwhs" target="_blank" title="Segmentfault" rel="external nofollow"><i class="fa fa-fw fa-globe"></i>Segmentfault</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#浏览器工作原理与实践"><span class="nav-number">2.</span> <span class="nav-text">浏览器工作原理与实践</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Chrome-架构：仅仅打开了-1-个页面，为什么有-4-个进程"><span class="nav-number">2.1.</span> <span class="nav-text">Chrome 架构：仅仅打开了 1 个页面，为什么有 4 个进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TCP-协议：如何保证页面文件能被完整送达浏览器"><span class="nav-number">2.2.</span> <span class="nav-text">TCP 协议：如何保证页面文件能被完整送达浏览器]</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP-请求流程：为什么很多站点第二次打开速度会很快"><span class="nav-number">2.3.</span> <span class="nav-text">HTTP 请求流程：为什么很多站点第二次打开速度会很快</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#导航流程：从输入-URL-到页面展示这中间发生了什么"><span class="nav-number">2.4.</span> <span class="nav-text">导航流程：从输入 URL 到页面展示这中间发生了什么</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染流程（上）：HTML、CSS-和-JavaScript-是如何变成页面的"><span class="nav-number">2.5.</span> <span class="nav-text">渲染流程（上）：HTML、CSS 和 JavaScript 是如何变成页面的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染流程（下）：HTML、CSS-和-JavaScript-是如何变成页面的"><span class="nav-number">2.6.</span> <span class="nav-text">渲染流程（下）：HTML、CSS 和 JavaScript 是如何变成页面的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#变量提升：javascript-代码是按顺序执行的吗"><span class="nav-number">2.7.</span> <span class="nav-text">变量提升：javascript 代码是按顺序执行的吗</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#调用栈：为什么-JavaScript-代码会出现栈溢出"><span class="nav-number">2.8.</span> <span class="nav-text">调用栈：为什么 JavaScript 代码会出现栈溢出</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#块级作用域：var-缺陷以及为什么要引入-let-和-const"><span class="nav-number">2.9.</span> <span class="nav-text">块级作用域：var 缺陷以及为什么要引入 let 和 const</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#作用域链和闭包：代码中出现相同的变量，JavaScript-引擎如何选择"><span class="nav-number">2.10.</span> <span class="nav-text">作用域链和闭包：代码中出现相同的变量，JavaScript 引擎如何选择</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#this：从-JavaScript-执行上下文视角讲-this"><span class="nav-number">2.11.</span> <span class="nav-text">this：从 JavaScript 执行上下文视角讲 this</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#栈空间和堆空间：数据是如何存储的"><span class="nav-number">2.12.</span> <span class="nav-text">栈空间和堆空间：数据是如何存储的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#垃圾回收：垃圾数据如何自动回收"><span class="nav-number">2.13.</span> <span class="nav-text">垃圾回收：垃圾数据如何自动回收</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#编译器和解析器：V8-如何执行一段-JavaScript-代码的"><span class="nav-number">2.14.</span> <span class="nav-text">编译器和解析器：V8 如何执行一段 JavaScript 代码的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#消息队列和事件循环：页面是怎么活起来的"><span class="nav-number">2.15.</span> <span class="nav-text">消息队列和事件循环：页面是怎么活起来的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webapi：setTimeout-是怎么实现的"><span class="nav-number">2.16.</span> <span class="nav-text">webapi：setTimeout 是怎么实现的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#webpai：XMLHttpRequest-是怎么实现的"><span class="nav-number">2.17.</span> <span class="nav-text">webpai：XMLHttpRequest 是怎么实现的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#宏任务和微任务：不是所有的任务都是一个待遇"><span class="nav-number">2.18.</span> <span class="nav-text">宏任务和微任务：不是所有的任务都是一个待遇</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用-Promise-告别回调函数"><span class="nav-number">2.19.</span> <span class="nav-text">使用 Promise 告别回调函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#async-await-使用同步方式写异步代码"><span class="nav-number">2.20.</span> <span class="nav-text">async await 使用同步方式写异步代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面性能分析：利用-chrome-做-web-性能分析"><span class="nav-number">2.21.</span> <span class="nav-text">页面性能分析：利用 chrome 做 web 性能分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DOM-树：JavaScript-是如何影响-DOM-树构建的"><span class="nav-number">2.22.</span> <span class="nav-text">DOM 树：JavaScript 是如何影响 DOM 树构建的</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#渲染流水线：CSS-如何影响首次加载时的白屏时间？"><span class="nav-number">2.23.</span> <span class="nav-text">渲染流水线：CSS 如何影响首次加载时的白屏时间？</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#分层和合成机制：为什么-CSS-动画比-JavaScript-高效"><span class="nav-number">2.24.</span> <span class="nav-text">分层和合成机制：为什么 CSS 动画比 JavaScript 高效</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#页面性能：如何系统优化页面"><span class="nav-number">2.25.</span> <span class="nav-text">页面性能：如何系统优化页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#虚拟-DOM：虚拟-DOM-和真实-DOM-有何不同"><span class="nav-number">2.26.</span> <span class="nav-text">虚拟 DOM：虚拟 DOM 和真实 DOM 有何不同</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PWA：解决-web-应用哪些问题"><span class="nav-number">2.27.</span> <span class="nav-text">PWA：解决 web 应用哪些问题</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WebComponent：像搭积木一样构建-web-应用"><span class="nav-number">2.28.</span> <span class="nav-text">WebComponent：像搭积木一样构建 web 应用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP1：HTTP1-性能优化"><span class="nav-number">2.29.</span> <span class="nav-text">HTTP1：HTTP1 性能优化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP2：如何提升网络速度"><span class="nav-number">2.30.</span> <span class="nav-text">HTTP2：如何提升网络速度</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTP3：甩掉-TCP、TCL-包袱，构建高效网络"><span class="nav-number">2.31.</span> <span class="nav-text">HTTP3：甩掉 TCP、TCL 包袱，构建高效网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#同源策略：为什么-XMLHttpRequst-不能跨域请求"><span class="nav-number">2.32.</span> <span class="nav-text">同源策略：为什么 XMLHttpRequst 不能跨域请求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#跨站脚本攻击-XSS：为什么-cookie-中有-httpOnly-属性"><span class="nav-number">2.33.</span> <span class="nav-text">跨站脚本攻击 XSS：为什么 cookie 中有 httpOnly 属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#CSRF-攻击：陌生连接不要随便点"><span class="nav-number">2.34.</span> <span class="nav-text">CSRF 攻击：陌生连接不要随便点</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#沙盒：页面和系统之间的隔离墙"><span class="nav-number">2.35.</span> <span class="nav-text">沙盒：页面和系统之间的隔离墙</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#HTTPS：让数据传输更安全"><span class="nav-number">2.36.</span> <span class="nav-text">HTTPS：让数据传输更安全</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#原文整理"><span class="nav-number">3.</span> <span class="nav-text">原文整理</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#宏观视角上的浏览器"><span class="nav-number">3.1.</span> <span class="nav-text">宏观视角上的浏览器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浏览器中的-JavaScript-执行机制"><span class="nav-number">3.2.</span> <span class="nav-text">浏览器中的 JavaScript 执行机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#V8-工作原理"><span class="nav-number">3.3.</span> <span class="nav-text">V8 工作原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浏览器中的页面循环系统"><span class="nav-number">3.4.</span> <span class="nav-text">浏览器中的页面循环系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浏览器中的页面"><span class="nav-number">3.5.</span> <span class="nav-text">浏览器中的页面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#浏览器中的网络"><span class="nav-number">3.6.</span> <span class="nav-text">浏览器中的网络</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2022</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">copyright by wuwh's blog</span>

  

  
</div>


  










        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>












  













  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.4.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.4.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.4.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.4.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.4.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.4.0"></script>



  



  










  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  
  

  

  

  

  

  

</body>
</html>
